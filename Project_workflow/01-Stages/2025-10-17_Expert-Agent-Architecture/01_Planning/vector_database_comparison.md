# –û–±–∑–æ—Ä –≤—ã–±–æ—Ä–∞ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Expert Agent

**–î–∞—Ç–∞:** 2025-10-17
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ

---

## –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ü—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ Expert Agent –≤–æ–∑–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π pgvector –Ω–∞ Windows –¥–ª—è PostgreSQL 18:
- ‚ùå –ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤ –¥–ª—è PostgreSQL 18 –Ω–∞ Windows
- ‚ùå –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ —Ç—Ä–µ–±—É–µ—Ç Visual Studio –∏ —Å–ª–æ–∂–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ù—É–∂–Ω–æ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°

---

## –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: PostgreSQL + pgvector (–ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω)

#### –û–ø–∏—Å–∞–Ω–∏–µ
–•—Ä–∞–Ω–∏—Ç—å –í–°–Å –≤ –æ–¥–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL, –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞.

#### –ó–ê ‚úÖ
- –í—Å—ë –≤ –æ–¥–Ω–æ–π –ë–î (–¥–∞–Ω–Ω—ã–µ + –≤–µ–∫—Ç–æ—Ä—ã)
- ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü—Ä–æ—Å—Ç—ã–µ JOIN –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ –≤–µ–∫—Ç–æ—Ä–∞–º–∏
- –ù–µ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å 2 –ë–î
- –û–¥–∏–Ω –±—ç–∫–∞–ø –¥–ª—è –≤—Å–µ–≥–æ
- –ú–µ–Ω—å—à–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (1 —Å–µ—Ä–≤–∏—Å –≤–º–µ—Å—Ç–æ 2)
- –ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### –ü–†–û–¢–ò–í ‚ùå
- **–ü—Ä–æ–±–ª–µ–º—ã —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π pgvector –Ω–∞ Windows** (—Å–µ–π—á–∞—Å —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å)
- –ù–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤ –¥–ª—è PostgreSQL 18 –Ω–∞ Windows
- PostgreSQL –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–∞—Ö (>1M –≤–µ–∫—Ç–æ—Ä–æ–≤)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (–Ω–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –Ω–µ—Ç re-ranking)
- HNSW –∏–Ω–¥–µ–∫—Å—ã –≤ pgvector –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã —á–µ–º –≤ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏—è—Ö

#### –í–µ—Ä–¥–∏–∫—Ç
‚ö†Ô∏è –•–æ—Ä–æ—à –¥–ª—è production, –Ω–æ **–ø—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–µ–Ω –¥–ª—è DEV –Ω–∞ Windows**. –¢—Ä–µ–±—É–µ—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–ª–∏–∑–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤.

---

### –í–∞—Ä–∏–∞–Ω—Ç 2A: PostgreSQL + Qdrant üåü (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

#### –û–ø–∏—Å–∞–Ω–∏–µ
–ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- **PostgreSQL** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (sources, sections, criteria)
- **Qdrant** - –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ embeddings –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Expert Agent (Python)                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Business Logic  ‚îÇ      ‚îÇ  Vector Search     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ           ‚îÇ                         ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                         ‚îÇ
            ‚ñº                         ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  PostgreSQL     ‚îÇ      ‚îÇ    Qdrant       ‚îÇ
   ‚îÇ  Port: 5434     ‚îÇ      ‚îÇ  Port: 6333     ‚îÇ
   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
   ‚îÇ knowledge_      ‚îÇ      ‚îÇ collections:    ‚îÇ
   ‚îÇ   sources       ‚îÇ      ‚îÇ - sections      ‚îÇ
   ‚îÇ knowledge_      ‚îÇ      ‚îÇ - examples      ‚îÇ
   ‚îÇ   sections      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                 ‚îÇ
   ‚îÇ evaluation_     ‚îÇ IDs  ‚îÇ vectors +       ‚îÇ
   ‚îÇ   criteria      ‚îÇ      ‚îÇ metadata        ‚îÇ
   ‚îÇ successful_     ‚îÇ      ‚îÇ                 ‚îÇ
   ‚îÇ   examples      ‚îÇ      ‚îÇ HNSW index      ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Workflow
```python
# Expert Agent –¥–µ–ª–∞–µ—Ç 2 –∑–∞–ø—Ä–æ—Å–∞:

# 1. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ Qdrant (–±—ã—Å—Ç—Ä–æ!)
results = qdrant_client.search(
    collection_name="knowledge_sections",
    query_vector=question_embedding,  # [1536] ruBERT
    limit=10,
    score_threshold=0.75,
    query_filter={
        "must": [
            {"key": "fund", "match": {"value": "fpg"}},
            {"key": "is_active", "match": {"value": True}}
        ]
    }
)

# results = [
#   {id: 42, score: 0.89, payload: {section_id: 42, fund: "fpg"}},
#   {id: 15, score: 0.85, payload: {section_id: 15, fund: "fpg"}},
#   ...
# ]

# 2. –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ PostgreSQL
section_ids = [r.payload["section_id"] for r in results]
sections = await db.query(
    """
    SELECT ks.*, src.title as source_title
    FROM knowledge_sections ks
    JOIN knowledge_sources src ON ks.source_id = src.id
    WHERE ks.id = ANY($1)
    ORDER BY array_position($1, ks.id)
    """,
    section_ids
)

# 3. LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ sections
answer = await gigachat.generate(
    context=sections,
    question=user_question
)
```

#### –ó–ê ‚úÖ
- **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞ 1 –∫–æ–º–∞–Ω–¥—É**: `docker run -p 6333:6333 qdrant/qdrant`
- **–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows/Linux/Mac** - –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π
- **Rust** (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ!) + HTTP API
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π persistence** (–Ω–µ —Ç–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ)
- **–û—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º!** (—Ä–æ—Å—Å–∏–π—Å–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è)
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** –ø–æ metadata (fund, date, type)
- **Batch –æ–ø–µ—Ä–∞—Ü–∏–∏** (–∑–∞–≥—Ä—É–∑–∫–∞ 1000+ –≤–µ–∫—Ç–æ—Ä–æ–≤ –∑–∞ —Ä–∞–∑)
- **Python SDK** –∏–∑ –∫–æ—Ä–æ–±–∫–∏: `pip install qdrant-client`
- **REST API** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ n8n
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Web UI** –Ω–∞ http://localhost:6333/dashboard
- **–õ—É—á—à–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** —á–µ–º pgvector –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ distributed —Ä–µ–∂–∏–º–∞** (–∫–ª–∞—Å—Ç–µ—Ä) –≤ –±—É–¥—É—â–µ–º
- **Quantization** - —Å–∂–∞—Ç–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ RAM
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ HNSW –∏–Ω–¥–µ–∫—Å—ã** - –±—ã—Å—Ç—Ä–µ–µ —á–µ–º –≤ pgvector

#### –ü–†–û–¢–ò–í ‚ùå
- –ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É PostgreSQL –∏ Qdrant
- –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å (–µ—â–µ –æ–¥–∏–Ω Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
- –ù–µ—Ç JOIN –Ω–∞–ø—Ä—è–º—É—é —Å PostgreSQL (–Ω—É–∂–Ω–æ 2 –∑–∞–ø—Ä–æ—Å–∞)
- –°–ª–æ–∂–Ω–µ–µ –±—ç–∫–∞–ø (–Ω—É–∂–Ω–æ –±—ç–∫–∞–ø–∏—Ç—å –æ–±–µ –ë–î –æ—Ç–¥–µ–ª—å–Ω–æ)
- –ú–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```python
# –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞:
async def add_knowledge_section(section_data):
    # 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ PostgreSQL
    section_id = await db.insert("knowledge_sections", section_data)

    # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding
    embedding = await rubert.encode(section_data["content"])

    # 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Qdrant
    await qdrant.upsert(
        collection_name="knowledge_sections",
        points=[{
            "id": section_id,
            "vector": embedding.tolist(),
            "payload": {
                "section_id": section_id,
                "fund": section_data["fund"],
                "is_active": True,
                "created_at": datetime.now().isoformat()
            }
        }]
    )

    return section_id
```

#### –ë—ç–∫–∞–ø —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø (cron –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

# 1. PostgreSQL
pg_dump -h localhost -p 5434 -U grantservice grantservice \
  > /backups/postgres_$(date +%Y%m%d).sql

# 2. Qdrant (snapshot)
curl -X POST 'http://localhost:6333/collections/knowledge_sections/snapshots'
# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å snapshot —Ñ–∞–π–ª—ã –∏–∑ ./storage/snapshots/
```

#### –í–µ—Ä–¥–∏–∫—Ç
üèÜ **–õ–£–ß–®–ò–ô –í–´–ë–û–† –¥–ª—è GrantService!**
- ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É pgvector –Ω–∞ Windows
- ‚úÖ –ú–æ–∂–µ–º –Ω–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°
- ‚úÖ Production-ready
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –∏ –≥–∏–±—á–µ —á–µ–º pgvector

---

### –í–∞—Ä–∏–∞–Ω—Ç 2B: PostgreSQL + ChromaDB

#### –û–ø–∏—Å–∞–Ω–∏–µ
–õ–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î –Ω–∞ Python (SQLite –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º).

#### –ó–ê ‚úÖ
- –°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π (Python only, –Ω–µ –Ω—É–∂–µ–Ω Docker)
- `pip install chromadb` –∏ –≤—Å—ë!
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π embedding (OpenAI, HuggingFace, Sentence Transformers)
- –•–æ—Ä–æ—à –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings

#### –ü–†–û–¢–ò–í ‚ùå
- **–ù–µ production-ready** (SQLite - –Ω–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –Ω–∞–≥—Ä—É–∑–æ–∫)
- –ú–µ–¥–ª–µ–Ω–Ω—ã–π –Ω–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (>100k –≤–µ–∫—Ç–æ—Ä–æ–≤)
- –ù–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- –ù–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –ú–µ–Ω—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

#### –í–µ—Ä–¥–∏–∫—Ç
‚ö†Ô∏è –•–æ—Ä–æ—à –¥–ª—è DEV/POC, –Ω–æ **–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è production**.

---

### –í–∞—Ä–∏–∞–Ω—Ç 2C: PostgreSQL + Milvus

#### –û–ø–∏—Å–∞–Ω–∏–µ
Enterprise-grade –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Alibaba, Nvidia).

#### –ó–ê ‚úÖ
- –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π (C++, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–æ –ø—Ä–µ–¥–µ–ª–∞)
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ **–º–∏–ª–ª–∏–∞—Ä–¥—ã –≤–µ–∫—Ç–æ—Ä–æ–≤**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU acceleration
- Distributed architecture –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (HNSW, IVF, DiskANN)

#### –ü–†–û–¢–ò–í ‚ùå
- **–û—á–µ–Ω—å —Å–ª–æ–∂–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞** (etcd, MinIO, Pulsar...)
- **Overkill** –¥–ª—è –≤–∞—à–∏—Ö –∑–∞–¥–∞—á (—É –≤–∞—Å ~10k –≤–µ–∫—Ç–æ—Ä–æ–≤, Milvus –¥–ª—è –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤)
- –¢—è–∂–µ–ª—ã–π (–Ω—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 8GB RAM)
- –°–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

#### –í–µ—Ä–¥–∏–∫—Ç
‚ùå **–°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ** –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á GrantService. –î–ª—è 10-100k –≤–µ–∫—Ç–æ—Ä–æ–≤ —ç—Ç–æ –∫–∞–∫ –ø—É—à–∫–æ–π –ø–æ –≤–æ—Ä–æ–±—å—è–º.

---

### –í–∞—Ä–∏–∞–Ω—Ç 2D: PostgreSQL + Weaviate

#### –û–ø–∏—Å–∞–Ω–∏–µ
GraphQL-based –≤–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ ML –º–æ–¥–µ–ª—è–º–∏.

#### –ó–ê ‚úÖ
- GraphQL API (—É–¥–æ–±–Ω—ã–π query language)
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (OpenAI, Cohere, HuggingFace)
- –•–æ—Ä–æ—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LangChain
- Semantic search + hybrid search (keyword + vector)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞ (schema inference)

#### –ü–†–û–¢–ò–í ‚ùå
- –ù—É–∂–µ–Ω Go runtime
- –°–ª–æ–∂–Ω–µ–µ —á–µ–º Qdrant
- –ú–µ–Ω—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –ë–æ–ª–µ–µ —Ç—è–∂–µ–ª—ã–π (—Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤)

#### –í–µ—Ä–¥–∏–∫—Ç
‚ö†Ô∏è –•–æ—Ä–æ—à, –Ω–æ **Qdrant –ø—Ä–æ—â–µ –∏ –ª–µ–≥—á–µ** –¥–ª—è –Ω–∞—à–∏—Ö –∑–∞–¥–∞—á.

---

## –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | pgvector | Qdrant | ChromaDB | Milvus | Weaviate |
|----------|----------|--------|----------|--------|----------|
| **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Windows** | ‚ùå –°–ª–æ–∂–Ω–æ | ‚úÖ Docker | ‚úÖ pip install | ‚ùå –û—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ |
| **–°–∫–æ—Ä–æ—Å—Ç—å (10k –≤–µ–∫—Ç–æ—Ä–æ–≤)** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–°–∫–æ—Ä–æ—Å—Ç—å (1M+ –≤–µ–∫—Ç–æ—Ä–æ–≤)** | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **Production-ready** | ‚úÖ –î–∞ | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (RU)** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê |
| **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è metadata** | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è | ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞—è | ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è | ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è |
| **Memory usage (10k)** | 100 MB | 150 MB | 50 MB | 500 MB | 300 MB |
| **ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç | ‚ùå –ù–µ—Ç |
| **–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** | ‚ö†Ô∏è PG –∫–ª–∞—Å—Ç–µ—Ä | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| **REST API** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚úÖ –î–∞ | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| **Web UI** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚úÖ –î–∞ |

---

## –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è üèÜ

### –í—ã–±–æ—Ä: PostgreSQL + Qdrant (–ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

#### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ Qdrant?

1. ‚úÖ **–û–±—Ö–æ–¥–∏–º –ø—Ä–æ–±–ª–µ–º—É pgvector –Ω–∞ Windows**
   - –ú–æ–∂–µ–º —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°
   - –ù–µ –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å —Ä–µ–ª–∏–∑–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤ –∏–ª–∏ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å

2. ‚úÖ **Qdrant –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∑–∞ 30 —Å–µ–∫—É–Ω–¥**
   ```bash
   docker run -p 6333:6333 -v $(pwd)/qdrant_storage:/qdrant/storage qdrant/qdrant
   ```

3. ‚úÖ **PostgreSQL —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –ù–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º–µ
   - –í—Å–µ –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ PostgreSQL

4. ‚úÖ **–õ–µ–≥–∫–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º**
   - –ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ pgvector - –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL —É–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã
   - –ò–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –¥—Ä—É–≥—É—é –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î

5. ‚úÖ **–õ—É—á—à–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è**
   - –ö–æ–≥–¥–∞ –±–∞–∑–∞ –≤—ã—Ä–∞—Å—Ç–µ—Ç –¥–æ 100k+ –≤–µ–∫—Ç–æ—Ä–æ–≤, Qdrant –±—É–¥–µ—Ç –±—ã—Å—Ç—Ä–µ–µ
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä Qdrant –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

6. ‚úÖ **Production-ready**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production –∫—Ä—É–ø–Ω—ã–º–∏ –∫–æ–º–ø–∞–Ω–∏—è–º–∏
   - –°—Ç–∞–±–∏–ª—å–Ω—ã–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π
   - –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

7. ‚úÖ **–†–æ—Å—Å–∏–π—Å–∫–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
   - –û—Ç–ª–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –∏–∑ –∫–æ—Ä–æ–±—ã

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: DEV (–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ Windows)

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
PostgreSQL 18.0 (localhost:5432)
‚îî‚îÄ‚îÄ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã + –Ω–æ–≤—ã–µ (–±–µ–∑ knowledge_embeddings)

Qdrant (Docker, localhost:6333)
‚îî‚îÄ‚îÄ Collections –¥–ª—è –≤–µ–∫—Ç–æ—Ä–æ–≤
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å Qdrant –≤ Docker
2. ‚úÖ –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 012 (—É–±—Ä–∞—Ç—å knowledge_embeddings —Ç–∞–±–ª–∏—Ü—É)
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å Python –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Qdrant
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ExpertAgent —Å Qdrant –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

---

### –≠—Ç–∞–ø 2: PROD (–°–µ—Ä–≤–µ—Ä 5.35.88.251)

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
PostgreSQL 18.0 (5.35.88.251:5434)
‚îî‚îÄ‚îÄ Production –ë–î grantservice

Qdrant (Docker, 5.35.88.251:6333)
‚îî‚îÄ‚îÄ Production –≤–µ–∫—Ç–æ—Ä—ã
```

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Qdrant –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ Docker Compose
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å persistence –∏ –±—ç–∫–∞–ø—ã
3. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –≤ prod
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)
5. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å n8n workflows

---

### –≠—Ç–∞–ø 3 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ pgvector

–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –∑–∞—Ö–æ—Ç–∏–º —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

**–ü—Ä–µ–¥–ø–æ—Å—ã–ª–∫–∏:**
- –í—ã–π–¥–µ—Ç pgvector –¥–ª—è PostgreSQL 18 –Ω–∞ Windows
- –ò–ª–∏ –º–∏–≥—Ä–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä –Ω–∞ Linux —Å pgvector
- –ò–ª–∏ –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç <100k –≤–µ–∫—Ç–æ—Ä–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pgvector
2. –°–æ–∑–¥–∞—Ç—å knowledge_embeddings —Ç–∞–±–ª–∏—Ü—É
3. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ–∫—Ç–æ—Ä—ã –∏–∑ Qdrant –≤ PostgreSQL
4. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å ExpertAgent –Ω–∞ pgvector
5. –£–¥–∞–ª–∏—Ç—å Qdrant

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ Qdrant –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# DEV (Docker)
docker run -d \
  --name qdrant \
  -p 6333:6333 \
  -p 6334:6334 \
  -v ./qdrant_storage:/qdrant/storage:z \
  qdrant/qdrant

# Python SDK
pip install qdrant-client
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```python
# config/qdrant.py
from qdrant_client import QdrantClient
from qdrant_client.models import Distance, VectorParams

class QdrantConfig:
    HOST = "localhost"  # –∏–ª–∏ 5.35.88.251 –¥–ª—è prod
    PORT = 6333
    GRPC_PORT = 6334

    COLLECTIONS = {
        "knowledge_sections": {
            "vector_size": 1536,  # ruBERT
            "distance": Distance.COSINE
        }
    }

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
qdrant = QdrantClient(host=QdrantConfig.HOST, port=QdrantConfig.PORT)

# –°–æ–∑–¥–∞—Ç—å collection
qdrant.create_collection(
    collection_name="knowledge_sections",
    vectors_config=VectorParams(
        size=1536,
        distance=Distance.COSINE,
        on_disk=False  # –•—Ä–∞–Ω–∏—Ç—å –≤ RAM –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
    )
)
```

### API –º–µ—Ç–æ–¥—ã

```python
# 1. –î–æ–±–∞–≤–∏—Ç—å –≤–µ–∫—Ç–æ—Ä
qdrant.upsert(
    collection_name="knowledge_sections",
    points=[
        {
            "id": section_id,
            "vector": embedding.tolist(),  # [1536] float
            "payload": {
                "section_id": section_id,
                "fund": "fpg",
                "source_id": 42,
                "is_active": True
            }
        }
    ]
)

# 2. –ü–æ–∏—Å–∫
results = qdrant.search(
    collection_name="knowledge_sections",
    query_vector=question_embedding,
    limit=10,
    score_threshold=0.75,
    query_filter={
        "must": [
            {"key": "fund", "match": {"value": "fpg"}},
            {"key": "is_active", "match": {"value": True}}
        ]
    }
)

# 3. –û–±–Ω–æ–≤–∏—Ç—å payload
qdrant.set_payload(
    collection_name="knowledge_sections",
    payload={"is_active": False},
    points=[section_id]
)

# 4. –£–¥–∞–ª–∏—Ç—å
qdrant.delete(
    collection_name="knowledge_sections",
    points_selector=[section_id]
)

# 5. Batch –æ–ø–µ—Ä–∞—Ü–∏–∏
qdrant.upsert(
    collection_name="knowledge_sections",
    points=[
        {"id": 1, "vector": vec1, "payload": {...}},
        {"id": 2, "vector": vec2, "payload": {...}},
        # ... –¥–æ 1000 –∑–∞ —Ä–∞–∑
    ]
)
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```python
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ collection
info = qdrant.get_collection("knowledge_sections")
print(f"Vectors: {info.vectors_count}")
print(f"Points: {info.points_count}")

# Web UI
# http://localhost:6333/dashboard
```

---

## –ó–∞—Ç—Ä–∞—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤

### Qdrant

**Memory:**
- ~100 MB base
- ~1 KB –Ω–∞ –≤–µ–∫—Ç–æ—Ä (1536 float32)
- –î–ª—è 10,000 –≤–µ–∫—Ç–æ—Ä–æ–≤: ~110 MB
- –î–ª—è 100,000 –≤–µ–∫—Ç–æ—Ä–æ–≤: ~1 GB

**Disk:**
- Snapshots: ~—Ä–∞–≤–Ω–æ RAM usage
- WAL logs: ~10-20% –æ—Ç data size

**CPU:**
- Minimal –≤ idle
- Burst –ø—Ä–∏ –ø–æ–∏—Å–∫–µ (1-10ms –Ω–∞ –∑–∞–ø—Ä–æ—Å)

### PostgreSQL

–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π - —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

---

## –ë—ç–∫–∞–ø —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±—ç–∫–∞–ø (automated)

```bash
#!/bin/bash
# /var/GrantService/scripts/backup_all.sh

DATE=$(date +%Y%m%d_%H%M)

# 1. PostgreSQL
export PGPASSWORD='jPsGn%Nt%q#THnUB&&cqo*1Q'
pg_dump -h localhost -p 5434 -U grantservice grantservice \
  > /backups/postgres_${DATE}.sql

# 2. Qdrant snapshot
curl -X POST 'http://localhost:6333/collections/knowledge_sections/snapshots'

# 3. –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å snapshot
cp /var/GrantService/qdrant_storage/collections/knowledge_sections/snapshots/* \
   /backups/qdrant_${DATE}/

# 4. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ (>30 –¥–Ω–µ–π)
find /backups -name "*.sql" -mtime +30 -delete
find /backups -name "qdrant_*" -mtime +30 -exec rm -rf {} \;
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# 1. PostgreSQL
psql -h localhost -p 5434 -U grantservice -d grantservice < backup.sql

# 2. Qdrant
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Qdrant
docker stop qdrant

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å snapshot
cp backup_snapshot/* /var/GrantService/qdrant_storage/collections/knowledge_sections/snapshots/

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Qdrant
docker start qdrant

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ snapshot —á–µ—Ä–µ–∑ API
curl -X PUT 'http://localhost:6333/collections/knowledge_sections/snapshots/upload' \
  --data-binary @snapshot_file
```

---

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–±—É–¥—É—â–µ–µ)

–ï—Å–ª–∏ —Ä–µ—à–∏–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Qdrant –Ω–∞ pgvector:

```python
# migrate_to_pgvector.py

from qdrant_client import QdrantClient
import asyncpg

async def migrate():
    # 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –æ–±–µ–∏–º –ë–î
    qdrant = QdrantClient("localhost", 6333)
    pg = await asyncpg.connect("postgresql://...")

    # 2. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ PostgreSQL
    await pg.execute("""
        CREATE TABLE knowledge_embeddings (
            id SERIAL PRIMARY KEY,
            section_id INTEGER REFERENCES knowledge_sections(id),
            embedding vector(1536),
            created_at TIMESTAMP DEFAULT NOW()
        )
    """)

    # 3. –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ Qdrant
    offset = 0
    batch_size = 100

    while True:
        points, next_offset = qdrant.scroll(
            collection_name="knowledge_sections",
            limit=batch_size,
            offset=offset,
            with_vectors=True
        )

        if not points:
            break

        # 4. –ò–º–ø–æ—Ä—Ç –≤ PostgreSQL
        for point in points:
            await pg.execute(
                """
                INSERT INTO knowledge_embeddings (section_id, embedding)
                VALUES ($1, $2)
                """,
                point.payload["section_id"],
                point.vector
            )

        offset = next_offset
        print(f"Migrated {offset} vectors")

    print("Migration complete!")
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ò—Ç–æ–≥–æ–≤–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**

üèÜ **–ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: PostgreSQL + Qdrant**

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. –†–µ—à–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø—Ä–æ–±–ª–µ–º—É (pgvector –Ω–∞ Windows)
2. –ü–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—á–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ù–ï–ú–ï–î–õ–ï–ù–ù–û
3. Production-ready –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ
4. –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Qdrant –ª–æ–∫–∞–ª—å–Ω–æ
2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 012 (—É–±—Ä–∞—Ç—å knowledge_embeddings)
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ExpertAgent —Å Qdrant
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ DEV
5. –î–µ–ø–ª–æ–π –Ω–∞ PROD

---

**–ê–≤—Ç–æ—Ä:** Claude Code (grant-architect agent)
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-17
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
