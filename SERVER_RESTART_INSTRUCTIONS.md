# Инструкции по перезапуску бота на сервере

## Проблема
После автодеплоя файл базы данных обновился на сервере, но бот продолжает работать со старыми данными в памяти (19 вопросов вместо 15, нет подсказок).

## Решение

### 1. Проверка состояния базы данных на сервере
```bash
# Подключаемся к серверу
ssh your-server

# Переходим в папку проекта
cd /var/GrantService

# Запускаем проверку БД
python3 check_server_db.py
```

### 2. Перезапуск бота на сервере
```bash
# Вариант 1: Автоматический перезапуск
python3 restart_server_bot.py

# Вариант 2: Ручной перезапуск
./restart_server_bot.sh
```

### 3. Ручной перезапуск (если автоматика не сработает)
```bash
# Найти процессы бота
pgrep -f main.py

# Остановить все процессы бота
pkill -f main.py

# Подождать 3 секунды
sleep 3

# Перейти в папку telegram-bot
cd telegram-bot

# Запустить бота в фоне
nohup python3 main.py > /dev/null 2>&1 &

# Вернуться в корневую папку
cd ..

# Проверить что бот запустился
pgrep -f main.py
```

### 4. Проверка после перезапуска
```bash
# Проверяем что бот работает
pgrep -f main.py

# Проверяем логи бота (если есть)
tail -f telegram-bot/logs/telegram_bot.log

# Или проверяем системные логи
journalctl -f | grep python
```

## Созданные файлы

1. **restart_server_bot.py** - Python скрипт для автоматического перезапуска
   - Проверяет состояние БД
   - Находит и останавливает процессы бота
   - Запускает бота заново
   - Проверяет успешность запуска

2. **restart_server_bot.sh** - Bash скрипт-обертка

3. **check_server_db.py** - Детальная проверка состояния БД
   - Показывает количество вопросов
   - Проверяет наличие подсказок
   - Анализирует структуру таблиц

## Ожидаемый результат после перезапуска
- Бот должен показывать 15 активных вопросов (не 19)
- Вопросы должны содержать подсказки
- Автоматическое создание грантовых заявок должно работать
- Только одно уведомление о завершении интервью

## Для следующих деплоев
Рекомендуется добавить в процесс автодеплоя команду перезапуска бота:
```bash
# После git pull
python3 restart_server_bot.py