# 🤖 AI Agents Page - Visual Structure

## 📐 Архитектура страницы

```
┌─────────────────────────────────────────────────────────────────┐
│                    🤖 AI Агенты (v3.0.0)                        │
│                 Управление всеми AI агентами системы            │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  [📝 Interviewer] [✅ Auditor] [📐 Planner] [🔍 Researcher] [✍️ Writer]  │
└─────────────────────────────────────────────────────────────────┘
```

---

## TAB 1: 📝 Interviewer Agent

```
┌───────────────────────────────────────────────────────────────┐
│ ### 📝 Interviewer Agent                                      │
│ Описание: Собирает информацию через 24 вопроса               │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ Всего    │  │ Завершено│  │ Средний  │  │ Средняя  │    │
│  │ интервью │  │          │  │ прогресс │  │длитель-  │    │
│  │    0     │  │    0     │  │   0%     │  │ность     │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
│                                                               │
├───────────────────────────────────────────────────────────────┤
│ ### 📝 Управление промптами                                   │
│                                                               │
│ ┌─────────────────────────────────────────────────────────┐  │
│ │ Выберите промпт: [Dropdown ▼]                          │  │
│ │                                                         │  │
│ │ ▼ ✅ system_prompt (v1)                                │  │
│ │   ├─ Текст промпта: [Text Area]                       │  │
│ │   ├─ [💾 Сохранить] [🗑️ Удалить] [🧪 Тест]          │  │
│ └─────────────────────────────────────────────────────────┘  │
│                                                               │
├───────────────────────────────────────────────────────────────┤
│ 💡 Будущие улучшения: AI-powered dynamic questioning         │
└───────────────────────────────────────────────────────────────┘
```

---

## TAB 2: ✅ Auditor Agent

```
┌───────────────────────────────────────────────────────────────┐
│ ### ✅ Auditor Agent                                          │
│ Описание: Оценивает качество по 5 критериям (1-10)           │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ Всего    │  │ Одобрено │  │    На    │  │ Средний  │    │
│  │ оценок   │  │          │  │ доработку│  │  балл    │    │
│  │    0     │  │    0     │  │    0     │  │  0/10    │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
│                                                               │
├───────────────────────────────────────────────────────────────┤
│ ### 📊 Критерии оценки                                        │
│                                                               │
│ ▼ 📌 Полнота                                                 │
│   Completeness - насколько полно заполнена анкета            │
│   - Оценка от 1 до 10                                        │
│   - Влияет на итоговое решение                               │
│                                                               │
│ ▼ 📌 Ясность                                                 │
│   Clarity - насколько понятно описан проект                  │
│                                                               │
│ ▼ 📌 Реалистичность                                          │
│ ▼ 📌 Инновационность                                         │
│ ▼ 📌 Качество                                                │
│                                                               │
├───────────────────────────────────────────────────────────────┤
│ ### 📝 Управление промптами                                   │
│ [Аналогично Interviewer]                                     │
└───────────────────────────────────────────────────────────────┘
```

---

## TAB 3: 📐 Planner Agent

```
┌───────────────────────────────────────────────────────────────┐
│ ### 📐 Planner Agent                                          │
│ Описание: Создает структуру грантовой заявки                 │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐            │
│  │   Всего    │  │   Полный   │  │  Средне    │            │
│  │   планов   │  │  mapping   │  │  разделов  │            │
│  │      0     │  │      0     │  │      0     │            │
│  └────────────┘  └────────────┘  └────────────┘            │
│                                                               │
├───────────────────────────────────────────────────────────────┤
│ ### 📋 Шаблоны структур                                       │
│                                                               │
│ ▼ 📄 Президентский грант                                     │
│   1. Название проекта                                        │
│   2. Краткая аннотация                                       │
│   3. Описание проблемы                                       │
│   4. Цели и задачи                                           │
│   5. План реализации                                         │
│   6. Бюджет                                                  │
│   7. Ожидаемые результаты                                    │
│                                                               │
│ ▼ 📄 Молодежный грант                                        │
│   1. Название проекта                                        │
│   2. Актуальность                                            │
│   3. Целевая аудитория                                       │
│   4. Мероприятия                                             │
│   5. Команда                                                 │
│   6. Бюджет                                                  │
│                                                               │
├───────────────────────────────────────────────────────────────┤
│ ### 📝 Управление промптами                                   │
│ [Аналогично Interviewer]                                     │
└───────────────────────────────────────────────────────────────┘
```

---

## TAB 4: 🔍 Researcher Agent (САМЫЙ СЛОЖНЫЙ!)

```
┌───────────────────────────────────────────────────────────────┐
│ ### 🔍 Researcher Agent                                       │
│ Описание: Обогащает заявку данными через Perplexity API      │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│ ┌─────────────────────────────────────────────────────────┐  │
│ │  [📊 Статистика] [🔬 Исследования] [💰 Аналитика расходов]│  │
│ └─────────────────────────────────────────────────────────┘  │
│                                                               │
│ ═════════════════════════════════════════════════════════════ │
│ SUB-TAB 1: 📊 Статистика                                     │
│ ═════════════════════════════════════════════════════════════ │
│                                                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │  Всего   │  │Завершено │  │    В     │  │ Ошибки   │    │
│  │исследова-│  │          │  │ процессе │  │          │    │
│  │   ний    │  │    0     │  │    0     │  │    0     │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
│                                                               │
│  ### 📝 Управление промптами                                 │
│  [Аналогично Interviewer]                                    │
│                                                               │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│ ═════════════════════════════════════════════════════════════ │
│ SUB-TAB 2: 🔬 Исследования (ИЗ АРХИВА!)                      │
│ ═════════════════════════════════════════════════════════════ │
│                                                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │  Статус  │  │  Период  │  │    LLM   │  │Пользова- │    │
│  │    ▼     │  │    ▼     │  │провайдер │  │   тель   │    │
│  │  Все     │  │  Все     │  │    ▼     │  │   [ ]    │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
│                                                               │
│  Найдено исследований: 3                                     │
│                                                               │
│  ▼ ✅ #RS-20251003-user1-001 - user1                        │
│    ├─ ID исследования: #RS-20251003-user1-001               │
│    ├─ ID анкеты: #AN-20251003-user1-001                     │
│    ├─ Пользователь: @user1                                  │
│    ├─ Статус: completed                                     │
│    ├─ LLM провайдер: perplexity                             │
│    ├─ Модель: sonar                                         │
│    ├─ Создано: 2025-10-03 10:30:00                          │
│    ├─ Завершено: 2025-10-03 10:32:00                        │
│    │                                                         │
│    ├─ Результаты исследования:                              │
│    │  [Text Area with research_results - disabled]          │
│    │                                                         │
│    └─ [📄 Анкета] [📊 Детали] [📋 ID] [💾 Экспорт]        │
│                                                               │
│  ▼ 🔄 #RS-20251003-user2-002 - user2                        │
│  ▼ ❌ #RS-20251003-user3-003 - user3 (error)                │
│                                                               │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│ ═════════════════════════════════════════════════════════════ │
│ SUB-TAB 3: 💰 Аналитика расходов (ИЗ АРХИВА!)                │
│ ═════════════════════════════════════════════════════────════ │
│                                                               │
│  ┌──────────────────┐  ┌──────────────────┐  ┌────────────┐ │
│  │ 💰 Баланс        │  │ 📊 API Requests  │  │ 📥 Input   │ │
│  │ аккаунта:        │  │                  │  │ Tokens:    │ │
│  │                  │  │ sonar-pro: 5     │  │            │ │
│  │ Balance:         │  │ sonar med: 12    │  │ sonar:     │ │
│  │ 4.998765 USD     │  │ sonar low: 8     │  │ 1,234      │ │
│  │                  │  │                  │  │            │ │
│  │ Tier: 0          │  │                  │  │ reason-pro:│ │
│  │ Spent: 0.02 USD  │  │                  │  │ 567        │ │
│  └──────────────────┘  └──────────────────┘  └────────────┘ │
│                                                               │
│  ### 📈 Динамика расходов                                    │
│  [График расходов по дням - заглушка]                        │
│                                                               │
│  ### 🔄 Сравнение провайдеров                                │
│  [Сравнение GigaChat vs Perplexity - заглушка]              │
│                                                               │
└───────────────────────────────────────────────────────────────┘
```

---

## TAB 5: ✍️ Writer Agent

```
┌───────────────────────────────────────────────────────────────┐
│ ### ✍️ Writer Agent                                           │
│ Описание: Генерирует текст грантовой заявки через GigaChat   │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│ ┌─────────────────────────────────────────────────────────┐  │
│ │         [📊 Статистика] [📝 Тексты]                     │  │
│ └─────────────────────────────────────────────────────────┘  │
│                                                               │
│ ═════════════════════════════════════════════════════════════ │
│ SUB-TAB 1: 📊 Статистика                                     │
│ ═════════════════════════════════════════════════════════════ │
│                                                               │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐            │
│  │   Всего    │  │ Завершено  │  │  Средняя   │            │
│  │  текстов   │  │            │  │   оценка   │            │
│  │      0     │  │      0     │  │    0/10    │            │
│  └────────────┘  └────────────┘  └────────────┘            │
│                                                               │
│  ### 📝 Управление промптами                                 │
│  [Аналогично Interviewer]                                    │
│                                                               │
└───────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────┐
│ ═════════════════════════════════════════════════════════════ │
│ SUB-TAB 2: 📝 Тексты                                          │
│ ═════════════════════════════════════════════════════════════ │
│                                                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                   │
│  │  Статус  │  │  Период  │  │ Показать │                   │
│  │    ▼     │  │    ▼     │  │ записей  │                   │
│  │  Все     │  │  Все     │  │   [20]   │                   │
│  └──────────┘  └──────────┘  └──────────┘                   │
│                                                               │
│  Найдено текстов: 5                                          │
│                                                               │
│  ▼ ✅ Грант GRANT-001 - 2025-10-01                           │
│    ├─ ID гранта: GRANT-001                                   │
│    ├─ Пользователь: 123456789                                │
│    ├─ Статус: completed                                      │
│    ├─ Оценка качества: 8.5/10                                │
│    ├─ Создано: 2025-10-01 15:30:00                           │
│    ├─ Обновлено: 2025-10-01 15:35:00                         │
│    │                                                          │
│    └─ [👁️ Просмотр] [📤 Экспорт] [✏️ Редактировать]        │
│                                                               │
│  ▼ 📝 Грант GRANT-002 - 2025-10-02 (draft)                   │
│  ▼ ✅ Грант GRANT-003 - 2025-10-03                           │
│                                                               │
└───────────────────────────────────────────────────────────────┘
```

---

## 🔄 Data Flow Diagram

```
┌──────────────┐
│   User       │
└──────┬───────┘
       │
       │ Opens page
       ▼
┌──────────────────────────┐
│  🤖_Агенты.py (v3.0)     │
│                          │
│  main()                  │
│    │                     │
│    ├─► render_page_header()
│    │                     │
│    ├─► TABS:             │
│    │   ├─► TAB 1: render_interviewer_tab()
│    │   ├─► TAB 2: render_auditor_tab()
│    │   ├─► TAB 3: render_planner_tab()
│    │   ├─► TAB 4: render_researcher_tab()
│    │   │           ├─► render_researcher_statistics()
│    │   │           ├─► render_researcher_investigations()
│    │   │           └─► render_researcher_cost_analytics()
│    │   └─► TAB 5: render_writer_tab()
│    │               ├─► render_writer_statistics()
│    │               └─► render_writer_texts()
│    │                     │
└────┼─────────────────────┘
     │
     │ Fetch data
     ▼
┌────────────────────────────┐
│  Data Functions            │
│                            │
│  ├─► get_agent_statistics()
│  │         │                │
│  │         ▼                │
│  │    ┌─────────────┐      │
│  │    │ Database    │      │
│  │    │ (SQLite)    │      │
│  │    │             │      │
│  │    │ Tables:     │      │
│  │    │ • sessions  │      │
│  │    │ • auditor_  │      │
│  │    │   results   │      │
│  │    │ • planner_  │      │
│  │    │   structures│      │
│  │    │ • researcher│      │
│  │    │   _research │      │
│  │    │ • grants    │      │
│  │    └─────────────┘      │
│  │                          │
│  ├─► get_researcher_investigations()
│  │         │                │
│  │         ▼                │
│  │    ORM: get_all_research()
│  │                          │
│  └─► get_writer_generated_texts()
│            │                │
│            ▼                │
│       SQL: SELECT FROM grants
└────────────────────────────┘
```

---

## 📦 Component Hierarchy

```
main()
│
├─► UI Components (utils/ui_helpers.py)
│   ├─► render_page_header()
│   ├─► render_metric_cards()
│   └─► render_tabs()
│
├─► Agent Components (utils/agent_components.py)
│   ├─► render_agent_header()
│   ├─► render_prompt_management()
│   └─► render_agent_stats()
│
├─► Database (cached)
│   ├─► get_database() → GrantServiceDatabase
│   └─► get_admin_database() → AdminDatabase
│
└─► Tabs Rendering
    ├─► render_interviewer_tab()
    │   ├─► get_agent_statistics('interviewer')
    │   └─► render_prompt_management('interviewer')
    │
    ├─► render_auditor_tab()
    │   ├─► get_agent_statistics('auditor')
    │   └─► render_prompt_management('auditor')
    │
    ├─► render_planner_tab()
    │   ├─► get_agent_statistics('planner')
    │   └─► render_prompt_management('planner')
    │
    ├─► render_researcher_tab()
    │   ├─► render_researcher_statistics()
    │   │   ├─► get_agent_statistics('researcher')
    │   │   └─► render_prompt_management('researcher')
    │   │
    │   ├─► render_researcher_investigations()
    │   │   ├─► get_researcher_investigations()
    │   │   ├─► Apply filters
    │   │   └─► Display expanders with buttons
    │   │
    │   └─► render_researcher_cost_analytics()
    │       ├─► PerplexityService.get_combined_statistics()
    │       └─► Display balance + requests + tokens
    │
    └─► render_writer_tab()
        ├─► render_writer_statistics()
        │   ├─► get_agent_statistics('writer')
        │   └─► render_prompt_management('writer')
        │
        └─► render_writer_texts()
            ├─► get_writer_generated_texts()
            ├─► Apply filters
            └─► Display expanders with buttons
```

---

## 🎨 Color Scheme & Icons

### Agent Icons:
- 📝 Interviewer - Document with pen
- ✅ Auditor - Checkmark
- 📐 Planner - Ruler/Triangle
- 🔍 Researcher - Magnifying glass
- ✍️ Writer - Writing hand

### Status Icons:
- ✅ Completed/Success - Green checkmark
- 🔄 Processing/In progress - Blue refresh
- ❌ Error/Failed - Red X
- 📝 Draft - Yellow paper
- ⏸️ Paused - Orange pause

### Action Icons:
- 👁️ View - Eye
- 📤 Export - Outbox
- ✏️ Edit - Pencil
- 📄 Document - Paper
- 📊 Details - Chart
- 📋 Copy ID - Clipboard
- 💾 Save - Floppy disk

---

## 📏 Layout Metrics

### Column Layouts:
- **4 columns:** Statistics metrics (most pages)
- **3 columns:** Action buttons
- **2 columns:** Details view (left/right split)

### Expanders:
- **Default state:** Collapsed
- **Key elements:** research_id, grant_id, username
- **Height:** Auto-expand based on content

### Text Areas:
- **Results display:** 200px height
- **Disabled:** Yes (read-only)
- **Font:** Monospace for IDs

---

**Версия:** 3.0.0
**Последнее обновление:** 2025-10-03
