# Expert Agent - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-17
**–í–µ—Ä—Å–∏—è:** 1.0
**–ê–≤—Ç–æ—Ä—ã:** grant-architect agent
**–°—Ç–∞—Ç—É—Å:** üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–≠—Ç–∞–ø 1: –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î)

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
4. [API](#api)
5. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-–∞–≥–µ–Ω—Ç–∞–º–∏)
6. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
7. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
8. [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

---

## –û–±–∑–æ—Ä

### –ß—Ç–æ —Ç–∞–∫–æ–µ Expert Agent?

**Expert Agent** - —ç—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π AI-–∞–≥–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã GrantService, –∫–æ—Ç–æ—Ä—ã–π:

- üóÑÔ∏è **–•—Ä–∞–Ω–∏—Ç –±–∞–∑—É –∑–Ω–∞–Ω–∏–π** –≤ PostgreSQL (–≤–º–µ—Å—Ç–æ markdown —Ñ–∞–π–ª–æ–≤)
- üîç **–í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫** —á–µ—Ä–µ–∑ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ embeddings (pgvector)
- üéì **–î–æ–æ–±—É—á–∞–µ—Ç –¥—Ä—É–≥–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤** (Writer, Reviewer, Researcher, Interviewer)
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–Ω–∞–Ω–∏—è** —á–µ—Ä–µ–∑ Researcher agent
- ‚ú® **–°–ª—É–∂–∏—Ç –µ–¥–∏–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã** –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –≥—Ä–∞–Ω—Ç–æ–≤

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Expert Agent?

**–ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**
- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –≤ markdown (329 KB) –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º
- –ù–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ - —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π = —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ê–≥–µ–Ω—Ç—ã –Ω–µ "–æ–±—É—á–∞—é—Ç—Å—è" –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –ù–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏ –∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Expert Agent:**
- ‚ö° **–ë—ã—Å—Ç—Ä–µ–µ:** –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–µ (5-10 KB –≤–º–µ—Å—Ç–æ 329 KB)
- üìä **–ê–∫—Ç—É–∞–ª—å–Ω–µ–µ:** –ë–î –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Researcher
- üéØ **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ–µ:** –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ —Ä–∞–∑–¥–µ–ª—ã
- üìà **–í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å:** –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `knowledge_updates`
- üîÑ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ:** –ê–≥–µ–Ω—Ç—ã –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### High-Level Design

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         GrantService Ecosystem                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram    ‚îÇ         ‚îÇ    n8n Workflow        ‚îÇ
‚îÇ     Bot      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Orchestrator         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ                      ‚îÇ                 ‚îÇ
            ‚ñº                      ‚ñº                 ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ   Writer   ‚îÇ          ‚îÇ Reviewer ‚îÇ     ‚îÇInterview ‚îÇ
    ‚îÇ   Agent    ‚îÇ          ‚îÇ  Agent   ‚îÇ     ‚îÇ  Agent   ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ                      ‚îÇ                 ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                   ‚îÇ
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ       ‚≠ê EXPERT AGENT ‚≠ê                ‚îÇ
            ‚îÇ     (Knowledge Hub + Router)           ‚îÇ
            ‚îÇ                                        ‚îÇ
            ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
            ‚îÇ  ‚îÇ ‚Ä¢ query_knowledge()          ‚îÇ     ‚îÇ
            ‚îÇ  ‚îÇ ‚Ä¢ train_agent()              ‚îÇ     ‚îÇ
            ‚îÇ  ‚îÇ ‚Ä¢ update_knowledge()         ‚îÇ     ‚îÇ
            ‚îÇ  ‚îÇ ‚Ä¢ vector_search()            ‚îÇ     ‚îÇ
            ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                    ‚îÇ                    ‚îÇ
        ‚ñº                    ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL  ‚îÇ    ‚îÇ Researcher ‚îÇ      ‚îÇ  GigaChat  ‚îÇ
‚îÇ  + pgvector  ‚îÇ    ‚îÇ   Agent    ‚îÇ      ‚îÇ    API     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚îî‚îÄ‚îÄ Tables:
            ‚Ä¢ knowledge_sources
            ‚Ä¢ knowledge_sections
            ‚Ä¢ successful_grant_examples
            ‚Ä¢ evaluation_criteria
            ‚Ä¢ knowledge_embeddings (vector!)
            ‚Ä¢ knowledge_updates
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-----------|-----------|
| **Expert Agent Service** | Python 3.11 + FastAPI | REST API –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–ó |
| **PostgreSQL** | PostgreSQL 18.0 | –•—Ä–∞–Ω–∏–ª–∏—â–µ –∑–Ω–∞–Ω–∏–π |
| **pgvector** | Extension 0.5+ | –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ |
| **Embeddings** | ruBERT / sberGPT | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤ |
| **LLM** | GigaChat / Claude Code | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ |
| **n8n** | Self-hosted | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤ |

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞

Expert Agent –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **6 –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü** –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î `grantservice`:

#### 1. `knowledge_sources` - –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–Ω–∞–Ω–∏–π

–•—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (—Å—Ç–∞—Ç—å–∏ —Å —Å–∞–π—Ç–∞ –§–ü–ì, –º–µ—Ç–æ–¥–∏—á–∫–∏, –ø—Ä–∏–º–µ—Ä—ã).

```sql
CREATE TABLE knowledge_sources (
    id SERIAL PRIMARY KEY,
    fund_name VARCHAR(100) NOT NULL,      -- 'fpg', 'kultura', 'rosmolodjezh'
    source_type VARCHAR(50) NOT NULL,     -- 'official_article', 'example'
    title TEXT NOT NULL,
    url TEXT,
    version VARCHAR(20),                  -- '2025', '2024'
    is_active BOOLEAN DEFAULT true,
    priority INTEGER DEFAULT 5,
    metadata JSONB,
    downloaded_at TIMESTAMP DEFAULT NOW(),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 2. `knowledge_sections` - –†–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

–†–∞–∑–¥–µ–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ø—Ä–∏–º–µ—Ä—ã, —Å–æ–≤–µ—Ç—ã).

```sql
CREATE TABLE knowledge_sections (
    id SERIAL PRIMARY KEY,
    source_id INTEGER REFERENCES knowledge_sources(id),
    section_type VARCHAR(50) NOT NULL,    -- 'requirement', 'example', 'tip'
    section_name TEXT NOT NULL,           -- "–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞", "–ë—é–¥–∂–µ—Ç"
    content TEXT NOT NULL,
    char_limit INTEGER,                   -- 300, 5000, etc.
    priority INTEGER DEFAULT 5,
    tags TEXT[],
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 3. `successful_grant_examples` - –ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞—è–≤–æ–∫

```sql
CREATE TABLE successful_grant_examples (
    id SERIAL PRIMARY KEY,
    fund_name VARCHAR(100) NOT NULL,
    application_number VARCHAR(50),
    year INTEGER NOT NULL,
    direction VARCHAR(200),
    organization_name VARCHAR(200),
    region VARCHAR(100),
    requested_amount DECIMAL(12, 2),
    awarded_amount DECIMAL(12, 2),
    cofinancing_amount DECIMAL(12, 2),
    status VARCHAR(50) DEFAULT 'winner',
    full_text TEXT,
    extracted_parts JSONB,                -- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 4. `evaluation_criteria` - –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

10 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ —ç–∫—Å–ø–µ—Ä—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –§–ü–ì (–∫–∞–∂–¥—ã–π –¥–æ 10 –±–∞–ª–ª–æ–≤).

```sql
CREATE TABLE evaluation_criteria (
    id SERIAL PRIMARY KEY,
    fund_name VARCHAR(100) NOT NULL,
    criterion_number INTEGER,             -- 1-10 –¥–ª—è –§–ü–ì
    criterion_name VARCHAR(200) NOT NULL,
    max_score INTEGER NOT NULL DEFAULT 10,
    description TEXT NOT NULL,
    examples TEXT,
    tips TEXT,
    common_mistakes TEXT,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 5. `knowledge_embeddings` - –í–µ–∫—Ç–æ—Ä–Ω—ã–µ embeddings ‚ö°

**–°–∞–º–∞—è –≤–∞–∂–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞!** –•—Ä–∞–Ω–∏—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞.

```sql
CREATE TABLE knowledge_embeddings (
    id SERIAL PRIMARY KEY,
    section_id INTEGER REFERENCES knowledge_sections(id),
    embedding vector(1536),               -- –í–µ–∫—Ç–æ—Ä 1536 –∏–∑–º–µ—Ä–µ–Ω–∏–π!
    model_name VARCHAR(50) DEFAULT 'rubert',
    model_version VARCHAR(20),
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);

-- HNSW –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_knowledge_embeddings_hnsw
ON knowledge_embeddings USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫:**

1. –í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí Embedding (1536-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä)
2. –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ HNSW –∏–Ω–¥–µ–∫—Å
3. Cosine similarity –¥–ª—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è
4. –í–æ–∑–≤—Ä–∞—Ç top-5 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤

#### 6. `knowledge_updates` - –ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

Audit log –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π.

```sql
CREATE TABLE knowledge_updates (
    id SERIAL PRIMARY KEY,
    updated_by VARCHAR(50) NOT NULL,      -- 'expert_agent', 'researcher', 'admin'
    update_type VARCHAR(50) NOT NULL,     -- 'new', 'modified', 'deleted'
    description TEXT,
    affected_tables TEXT[],
    record_ids INTEGER[],
    old_values JSONB,                     -- –î–ª—è rollback
    new_values JSONB,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### Views –∏ Functions

#### View: `v_expert_active_knowledge`

–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞–Ω–∏—è —Å embeddings:

```sql
SELECT * FROM v_expert_active_knowledge
WHERE fund_name = 'fpg';
```

#### Function: `expert_search_similar_sections()`

–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫:

```sql
SELECT * FROM expert_search_similar_sections(
    query_embedding := '[0.123, -0.456, ...]'::vector(1536),
    fund_filter := 'fpg',
    top_k := 5,
    min_similarity := 0.75
);
```

---

## API

### Python Class: `ExpertAgent`

```python
from expert_agent import ExpertAgent

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
async with ExpertAgent(db_pool, embeddings_service, llm_client) as expert:

    # 1. –ó–∞–ø—Ä–æ—Å –∑–Ω–∞–Ω–∏–π (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫)
    result = await expert.query_knowledge(
        question="–ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å–∏–º–≤–æ–ª–∞–º –≤ —Ä–∞–∑–¥–µ–ª–µ '–û –ø—Ä–æ–µ–∫—Ç–µ'?",
        fund="fpg",
        top_k=5
    )
    print(result['answer'])
    print(f"Confidence: {result['confidence']:.2%}")

    # 2. –î–æ–æ–±—É—á–∏—Ç—å –∞–≥–µ–Ω—Ç–∞
    result = await expert.train_agent(
        agent_name="writer",
        fund="fpg",
        section="project_goals"
    )
    print(f"Updated prompt for Writer: {result['updated_prompt']}")

    # 3. –û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ Researcher
    result = await expert.update_knowledge(
        topic="fpg_requirements_2025",
        trigger="manual",
        validate=True
    )
    print(f"Added {result['sections_added']} new sections")

    # 4. Health check
    health = await expert.health_check()
    print(f"Status: {health['status']}")
```

### REST API Endpoints (FastAPI)

```python
# GET /api/expert/query
POST /api/expert/query
{
    "question": "–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ü–µ–ª—è–º –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –§–ü–ì?",
    "fund": "fpg",
    "top_k": 5,
    "min_similarity": 0.75
}

Response:
{
    "answer": "–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å SMART –∫—Ä–∏—Ç–µ—Ä–∏—è–º...",
    "sources": [42, 84, 91],
    "confidence": 0.92,
    "relevant_sections": [...]
}

# POST /api/expert/train
POST /api/expert/train
{
    "agent_name": "writer",
    "fund": "fpg",
    "format": "markdown"
}

Response:
{
    "status": "success",
    "updated_prompt": "...",
    "knowledge_items": 15,
    "version": "2025-10-17_v1"
}

# POST /api/expert/update
POST /api/expert/update
{
    "topic": "fpg_requirements_2025",
    "fund": "fpg",
    "trigger": "manual",
    "validate": true
}

Response:
{
    "status": "success",
    "sections_added": 5,
    "sections_updated": 2
}

# GET /api/expert/health
GET /api/expert/health

Response:
{
    "status": "healthy",
    "database": {"connected": true, "version": "18.0"},
    "statistics": {
        "total_sources": 15,
        "active_sources": 12,
        "sections": 127,
        "embeddings": 127
    }
}
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥–µ–Ω—Ç–∞–º–∏

### 1. Writer Agent ‚Üí Expert

**–°—Ç–∞—Ä—ã–π workflow:**
```
User ‚Üí Writer ‚Üí –ß–∏—Ç–∞–µ—Ç –≤–µ—Å—å UNIFIED_KNOWLEDGE_BASE.md (329 KB)
        ‚Üí –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç
```

**–ù–æ–≤—ã–π workflow:**
```
User ‚Üí Writer ‚Üí Expert.query_knowledge("–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ü–µ–ª—è–º?")
              ‚Üí Expert –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã (5-10 KB)
              ‚Üí Writer –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç
```

**–ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**

```python
# telegram-bot/agents/writer_agent.py

class WriterAgent(BaseAgent):
    def __init__(self, db, llm_provider="claude_code"):
        super().__init__("writer", db, llm_provider)
        self.expert = ExpertAgent(db, embeddings_service, llm_client)

    async def write_section(self, section_name: str, user_input: str):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–∞ –∑–∞—è–≤–∫–∏"""

        # 1. –ó–∞–ø—Ä–æ—Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π —É Expert
        requirements = await self.expert.query_knowledge(
            question=f"–ö–∞–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–∞–∑–¥–µ–ª—É '{section_name}' –¥–ª—è –§–ü–ì?",
            fund="fpg",
            top_k=5
        )

        # 2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏
        prompt = f"""
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–∞–∑–¥–µ–ª—É '{section_name}':
{requirements['answer']}

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥:
{user_input}

–ù–∞–ø–∏—à–∏ —Ä–∞–∑–¥–µ–ª '{section_name}' –¥–ª—è –≥—Ä–∞–Ω—Ç–æ–≤–æ–π –∑–∞—è–≤–∫–∏.
        """

        # 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ LLM
        result = await self.llm.generate(prompt)

        return result
```

### 2. Reviewer Agent ‚Üí Expert

**–ó–∞–¥–∞—á–∞:** –û—Ü–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É –ø–æ 10 –∫—Ä–∏—Ç–µ—Ä–∏—è–º –§–ü–ì

```python
class ReviewerAgent(BaseAgent):
    async def review_application(self, application_id: str):
        """–û—Ü–µ–Ω–∫–∞ –∑–∞—è–≤–∫–∏"""

        # –ü–æ–ª—É—á–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ç Expert
        result = await self.expert.query_knowledge(
            question="–î–∞–π –≤—Å–µ 10 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –§–ü–ì",
            fund="fpg"
        )

        criteria = result['relevant_sections']  # 10 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤

        # –û—Ü–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É –∫—Ä–∏—Ç–µ—Ä–∏—é
        scores = []
        for criterion in criteria:
            score = await self._evaluate_criterion(
                application_id,
                criterion
            )
            scores.append(score)

        total_score = sum(scores)
        return {'total_score': total_score, 'criteria_scores': scores}
```

### 3. Researcher ‚Üî Expert (–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è!)

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: Expert –≤—ã–∑—ã–≤–∞–µ—Ç Researcher**

```python
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–ó
@scheduler.scheduled_job('cron', day_of_week='mon', hour=3)
async def update_knowledge_base():
    """–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π"""

    expert = ExpertAgent(...)

    # Expert ‚Üí Researcher: "–°–æ–±–µ—Ä–∏ –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"
    await expert.update_knowledge(
        topic="fpg_requirements_2025",
        trigger="scheduled"
    )
```

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: Researcher –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Expert**

```python
class ResearcherAgent(BaseAgent):
    async def find_examples(self, direction: str):
        """–ù–∞–π—Ç–∏ –ø—Ä–∏–º–µ—Ä—ã –∑–∞—è–≤–æ–∫"""

        # Researcher ‚Üí Expert: "–ü—Ä–∏–º–µ—Ä—ã –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é X"
        result = await self.expert.query_knowledge(
            question=f"–ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é '{direction}'",
            fund="fpg"
        )

        return result['relevant_sections']
```

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `database/migrations/012_add_expert_agent_tables.sql`

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (Windows):

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
cd C:\SnowWhiteAI\GrantService

# 2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
psql -U postgres -c "CREATE DATABASE grantservice_test;"

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
psql -U postgres -d grantservice_test -f database/migrations/012_add_expert_agent_tables.sql

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
psql -U postgres -d grantservice_test -c "SELECT * FROM v_expert_knowledge_stats;"
```

#### –ü—Ä–æ–¥–∞–∫—à–Ω (—Å–µ—Ä–≤–µ—Ä 5.35.88.251):

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@5.35.88.251

cd /var/GrantService

# Backup –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
export PGPASSWORD='jPsGn%Nt%q#THnUB&&cqo*1Q'
pg_dump -h localhost -p 5434 -U grantservice grantservice > backup_before_expert_$(date +%Y%m%d).sql

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
psql -h localhost -p 5434 -U grantservice -d grantservice -f database/migrations/012_add_expert_agent_tables.sql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
psql -h localhost -p 5434 -U grantservice -d grantservice -c "\dt knowledge*"
psql -h localhost -p 5434 -U grantservice -d grantservice -c "SELECT * FROM v_expert_knowledge_stats;"
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python

```bash
cd C:\SnowWhiteAI\GrantService

# –î–æ–±–∞–≤–∏—Ç—å –≤ requirements.txt
echo "pgvector==0.2.3" >> requirements.txt
echo "asyncpg==0.29.0" >> requirements.txt
echo "sentence-transformers==2.2.2" >> requirements.txt
echo "numpy==1.24.3" >> requirements.txt

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
pip install -r requirements.txt
```

### –®–∞–≥ 3: –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ Expert Agent

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ 00-Project-Stages
cp "00-Project-Stages/2025-10-17_Expert-Agent-Architecture/03_Implementation/expert_agent.py" \
   "shared/agents/expert_agent.py"
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤–∏—Ç—å –≤ `config/.env`:

```bash
# Expert Agent Settings
EXPERT_AGENT_ENABLED=true
EXPERT_AGENT_EMBEDDING_MODEL=rubert
EXPERT_AGENT_VECTOR_SEARCH_THRESHOLD=0.75
EXPERT_AGENT_DEFAULT_FUND=fpg

# Embeddings API (–≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω)
# –í–∞—Ä–∏–∞–Ω—Ç 1: ruBERT –ª–æ–∫–∞–ª—å–Ω–æ
RUBERT_MODEL_PATH=/path/to/rubert-tiny2

# –í–∞—Ä–∏–∞–Ω—Ç 2: sberGPT embeddings API
SBER_API_KEY=your_sber_api_key

# –í–∞—Ä–∏–∞–Ω—Ç 3: OpenAI (fallback)
OPENAI_API_KEY=your_openai_key
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–≠—Ç–∞–ø 2)

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü, –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `fpg_docs_2025/UNIFIED_KNOWLEDGE_BASE.md`:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
python scripts/migrate_knowledge_to_expert.py

# –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:
# 1. –ü–∞—Ä—Å–∏—Ç UNIFIED_KNOWLEDGE_BASE.md
# 2. –†–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ —Ä–∞–∑–¥–µ–ª—ã
# 3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ knowledge_sources –∏ knowledge_sections
# 4. –°–æ–∑–¥–∞–µ—Ç embeddings –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
# 5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ knowledge_embeddings
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# tests/test_expert_agent.py

import pytest
from shared.agents.expert_agent import ExpertAgent

@pytest.mark.asyncio
async def test_query_knowledge():
    """–¢–µ—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ –∑–Ω–∞–Ω–∏–π"""
    expert = ExpertAgent(db_pool, embeddings_service, llm_client)

    result = await expert.query_knowledge(
        question="–ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ä–∞–∑–¥–µ–ª–µ '–û –ø—Ä–æ–µ–∫—Ç–µ'?",
        fund="fpg"
    )

    assert result['confidence'] > 0.8
    assert len(result['sources']) > 0
    assert '—Å–∏–º–≤–æ–ª' in result['answer'].lower()

@pytest.mark.asyncio
async def test_train_writer():
    """–¢–µ—Å—Ç –¥–æ–æ–±—É—á–µ–Ω–∏—è Writer –∞–≥–µ–Ω—Ç–∞"""
    expert = ExpertAgent(...)

    result = await expert.train_agent("writer", fund="fpg")

    assert result['status'] == 'success'
    assert result['knowledge_items'] > 10
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
SELECT * FROM v_expert_knowledge_stats;

-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
SELECT * FROM v_expert_recent_updates LIMIT 10;

-- Health check
SELECT
    (SELECT COUNT(*) FROM knowledge_sources WHERE is_active = true) as active_sources,
    (SELECT COUNT(*) FROM knowledge_sections) as total_sections,
    (SELECT COUNT(*) FROM knowledge_embeddings) as total_embeddings,
    (SELECT COUNT(*) FROM knowledge_updates WHERE created_at >= NOW() - INTERVAL '7 days') as updates_last_week;
```

---

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–æ–Ω–¥

```sql
-- 1. –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏
INSERT INTO knowledge_sources (fund_name, source_type, title, url, version)
VALUES ('kultura', 'official_article', '–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –ö—É–ª—å—Ç—É—Ä–∞–†–§', 'https://...', '2025');

-- 2. –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª—ã
INSERT INTO knowledge_sections (source_id, section_type, section_name, content)
VALUES (
    (SELECT id FROM knowledge_sources WHERE fund_name = 'kultura' LIMIT 1),
    'requirement',
    '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞',
    '–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞–∑–≤–∞–Ω–∏—é...'
);

-- 3. –°–æ–∑–¥–∞—Ç—å embeddings
-- (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç)
python scripts/create_embeddings_for_fund.py --fund kultura
```

### –†–∞—Å—à–∏—Ä–∏—Ç—å API

```python
# shared/agents/expert_agent.py

class ExpertAgent:
    # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
    async def compare_applications(
        self,
        app1_id: str,
        app2_id: str,
        fund: str = 'fpg'
    ) -> Dict:
        """–°—Ä–∞–≤–Ω–∏—Ç—å –¥–≤–µ –∑–∞—è–≤–∫–∏ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º"""

        # –ü–æ–ª—É—á–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏
        criteria = await self._get_reviewer_knowledge(fund)

        # –°—Ä–∞–≤–Ω–∏—Ç—å
        comparison = {}
        for criterion in criteria:
            score1 = await self._evaluate_app(app1_id, criterion)
            score2 = await self._evaluate_app(app2_id, criterion)
            comparison[criterion['criterion_name']] = {
                'app1': score1,
                'app2': score2,
                'diff': score2 - score1
            }

        return comparison
```

---

## Roadmap

### ‚úÖ –≠—Ç–∞–ø 0: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ó–∞–≤–µ—Ä—à—ë–Ω)
- [x] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [x] SQL —Å—Ö–µ–º–∞
- [x] Python –∫–æ–¥
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üîÑ –≠—Ç–∞–ø 1: Database Schema (–í –ø—Ä–æ—Ü–µ—Å—Å–µ)
- [x] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 012
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
- [ ] –¢–µ—Å—Ç—ã —Å—Ö–µ–º—ã

### ‚è≥ –≠—Ç–∞–ø 2: Data Migration
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ UNIFIED_KNOWLEDGE_BASE.md
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ embeddings (ruBERT)
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### ‚è≥ –≠—Ç–∞–ø 3: Expert Agent Implementation
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ExpertAgent –∫–ª–∞—Å—Å–∞
- [ ] FastAPI endpoints
- [ ] Unit-—Ç–µ—Å—Ç—ã
- [ ] Integration-—Ç–µ—Å—Ç—ã

### ‚è≥ –≠—Ç–∞–ø 4: Writer Integration
- [ ] –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è Writer –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Expert
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

### ‚è≥ –≠—Ç–∞–ø 5: Full Integration
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
- [ ] Web Admin –ø–∞–Ω–µ–ª—å
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** `00-Project-Stages/2025-10-17_Expert-Agent-Architecture/01_Planning/architecture.md`
- **STATUS:** `STATUS.md`
- **SESSION CONTEXT:** `SESSION_CONTEXT_2025-10-17.md`
- **AI Agents:** `doc/AI_AGENTS_SETTINGS_ARCHITECTURE.md`
- **Database:** `doc/DATABASE.md`
- **Architecture:** `doc/ARCHITECTURE.md`

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-10-17
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é 012 –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
