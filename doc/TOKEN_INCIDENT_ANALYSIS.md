# –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –±–æ—Ç–∞

**–î–∞—Ç–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞**: 2025-10-01
**–í—Ä–µ–º—è**: 15:48-16:03 UTC
**–°—Ç–∞—Ç—É—Å**: –†–µ—à–µ–Ω–æ ‚úÖ

## üîç –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ

### Timeline —Å–æ–±—ã—Ç–∏–π

1. **15:48 UTC** - GitHub Actions –∑–∞–ø—É—Å—Ç–∏–ª deployment –ø–æ—Å–ª–µ commit `7b868de` (—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥)
2. **15:49 UTC** - –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω `git reset --hard origin/master`
3. **15:49 UTC** - Streamlit –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è —Å –Ω–æ–≤—ã–º –ø—É—Ç–µ–º (`web-admin/app_main.py`) - **–û–ö** ‚úÖ
4. **15:49+ UTC** - Bot –Ω–∞—á–∞–ª –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ —Å –æ—à–∏–±–∫–æ–π "TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" ‚ùå
5. **16:03 UTC** - –¢–æ–∫–µ–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –±—ç–∫–∞–ø–∞, bot –∑–∞–ø—É—â–µ–Ω - **–û–ö** ‚úÖ

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –î–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
```
/var/GrantService/config/
‚îú‚îÄ‚îÄ .env              # –†–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω (–ù–ï –≤ Git, –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ 18.07.2025)
‚îú‚îÄ‚îÄ config.env        # Placeholder —Ç–æ–∫–µ–Ω (–≤ Git, –∏–∑–º–µ–Ω–µ–Ω 02.08.2025)
‚îî‚îÄ‚îÄ .env.example      # –®–∞–±–ª–æ–Ω (–≤ Git)
```

### –ü–æ—Å–ª–µ git reset --hard
```
/var/GrantService/config/
‚îú‚îÄ‚îÄ .env              # –£–î–ê–õ–ï–ù (–±—ã–ª –≤ .gitignore)
‚îú‚îÄ‚îÄ config.env        # –ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –∏–∑ Git (placeholder)
‚îî‚îÄ‚îÄ .env.example      # –û–±–Ω–æ–≤–ª–µ–Ω –∏–∑ Git
```

### –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```
/var/GrantService/config/
‚îú‚îÄ‚îÄ .env              # ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –±—ç–∫–∞–ø–∞ (1 —Å—Ç—Ä–æ–∫–∞, 66 –±–∞–π—Ç)
‚îú‚îÄ‚îÄ config.env        # Placeholder (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ—Ç–æ–º)
‚îî‚îÄ‚îÄ .env.example      # –®–∞–±–ª–æ–Ω
```

## üéØ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –ó–∞—â–∏—Ç–∞ data/ –Ω–æ –Ω–µ config/.env
GitHub Actions workflow –∑–∞—â–∏—â–∞–ª —Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `data/`:

```bash
# –ó–∞—â–∏—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ data/ –æ—Ç git clean
if [ -d "data" ]; then
    mv data /tmp/grantservice_data_safe
fi

# ... git reset --hard ...

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ data/
mv /tmp/grantservice_data_safe data
```

**–ù–û** `config/.env` **–ù–ï** –±—ã–ª –∑–∞—â–∏—â–µ–Ω!

### –ü—Ä–æ–±–ª–µ–º–∞ #2: .gitignore —Å–∫—Ä—ã–≤–∞–µ—Ç —Ñ–∞–π–ª
`.env` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `.gitignore`:
```gitignore
# Environment variables
.env
.env.local
.env.production
```

–ü—Ä–∏ `git reset --hard origin/master` Git —É–¥–∞–ª–∏–ª **untracked** —Ñ–∞–π–ª `config/.env`.

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ë–æ—Ç –∏—â–µ—Ç config/.env, –∞ –Ω–µ config/config.env
```python
# telegram-bot/main.py:50
@property
def env_path(self) -> str:
    return os.path.join(self.base_path, 'config', '.env')
```

Bot —á–∏—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ** `config/.env`, –∏–≥–Ω–æ—Ä–∏—Ä—É—è `config/config.env`.

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ `config/.env` –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –±—ç–∫–∞–ø–∞ (—Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω)
- ‚úÖ Bot –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Streamlit –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ì–¥–µ —Å–µ–π—á–∞—Å —Ç–æ–∫–µ–Ω
```
/var/GrantService/config/.env (66 –±–∞–π—Ç)
TELEGRAM_BOT_TOKEN=7685915842:AAGcW0kgtljyIob8enM3zvFSLuZ-BZzcPOo
```

### –ß—Ç–æ –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–∫–µ–Ω
- ‚ùå `config/config.env` - —Å–æ–¥–µ—Ä–∂–∏—Ç placeholder
- ‚ùå Git repository - `.env` –≤ `.gitignore`
- ‚ùå GitHub - —Ñ–∞–π–ª –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

## üö® –ü–ª–∞–Ω –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è

### 1. –ó–∞—â–∏—Ç–∏—Ç—å config/.env –≤ deployment workflow

**–î–æ–±–∞–≤–∏—Ç—å –≤ `.github/workflows/deploy-grantservice.yml`**:

```yaml
# –ü–ï–†–ï–î git –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
echo "Protecting config/.env..."
if [ -f "config/.env" ]; then
    cp config/.env /tmp/grantservice_env_safe
    echo "‚úì Config backed up"
fi

# ... git reset --hard ...

# –ü–û–°–õ–ï git –æ–ø–µ—Ä–∞—Ü–∏–π
echo "Restoring config/.env..."
if [ -f "/tmp/grantservice_env_safe" ]; then
    cp /tmp/grantservice_env_safe config/.env
    chmod 600 config/.env
    echo "‚úì Config restored"
fi
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å systemd EnvironmentFile

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `scripts/setup_systemd_services.sh`**:
```ini
[Service]
EnvironmentFile=-/var/GrantService/config/.env
```

–§–ª–∞–≥ `-` –æ–∑–Ω–∞—á–∞–µ—Ç "–Ω–µ –ø–∞–¥–∞—Ç—å –µ—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç".

### 3. –°–æ–∑–¥–∞—Ç—å backup —Å–∫—Ä–∏–ø—Ç

**–°–∫—Ä–∏–ø—Ç `scripts/backup_secrets.sh`**:
```bash
#!/bin/bash
tar -czf /root/grantservice-secrets-$(date +%Y%m%d).tar.gz \
    /var/GrantService/config/.env \
    /var/GrantService/data/*.db
```

### 4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ deployment

–ü–æ—Å–ª–µ deployment –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞:
```bash
if ! grep -q "TELEGRAM_BOT_TOKEN=7685" config/.env 2>/dev/null; then
    echo "‚ùå ERROR: Token missing! Restoring from backup..."
    # Restore logic
fi
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

- **Downtime –±–æ—Ç–∞**: ~14 –º–∏–Ω—É—Ç (15:49 - 16:03)
- **Downtime –∞–¥–º–∏–Ω–∫–∏**: 0 –º–∏–Ω—É—Ç (—Ä–∞–±–æ—Ç–∞–ª–∞ –≤—Å—ë –≤—Ä–µ–º—è)
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤ –±–æ—Ç–∞**: 66 –ø–æ–ø—ã—Ç–æ–∫
- **–ü—Ä–∏—á–∏–Ω–∞**: –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ñ–∞–∫—Ç–æ—Ä (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤ CI/CD)
- **–ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö**: –ù–µ—Ç (–ë–î –∑–∞—â–∏—â–µ–Ω–∞)

## ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —É—Ä–æ–∫–∏

1. **–í—Å–µ–≥–¥–∞ –∑–∞—â–∏—â–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ config —Ñ–∞–π–ª—ã** –ø—Ä–∏ `git reset --hard`
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å systemd EnvironmentFile** –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
3. **–î–µ–ª–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã** `.env` —Ñ–∞–π–ª–æ–≤
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å CI/CD** –Ω–∞ staging –ø–µ—Ä–µ–¥ production
5. **–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

## üéØ Action Items

- [ ] –û–±–Ω–æ–≤–∏—Ç—å GitHub Actions workflow –¥–ª—è –∑–∞—â–∏—Ç—ã `config/.env`
- [ ] –°–æ–∑–¥–∞—Ç—å cron job –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ secrets
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å staging –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤

---

**–°–æ–∑–¥–∞–Ω–æ**: 2025-10-01
**–ê–≤—Ç–æ—Ä**: Claude Code
**–í–µ—Ä—Å–∏—è**: 1.0
