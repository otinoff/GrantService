# Очистка архитектурной документации от n8n

**Дата:** 2025-10-17
**Причина:** Корректировка документации в соответствии с реальной архитектурой проекта

## Проблема

В документации проекта (STATUS.md, ARCHITECTURE.md) были упоминания технологии **n8n** для автоматизации workflow, однако:

1. **n8n НЕ используется** в проекте
2. Папка `n8n-workflows/` была **пустой**
3. В коде **нет интеграции** с n8n
4. Реальная система использует **другой подход**

## Реальная архитектура автоматизации

### Что РЕАЛЬНО используется:

#### 1. Systemd Services
- `grantservice-bot.service` - Telegram бот (запускается автоматически)
- `grantservice-admin.service` - Web админка (запускается автоматически)
- Автоматический перезапуск при сбоях
- Управление через systemctl

#### 2. Python Scripts
- Скрипты в папке `scripts/` для различных задач
- Прямое выполнение через Python
- Интеграция через Python API

#### 3. Агенты общаются напрямую
- **Python API** - прямые вызовы методов между агентами
- **Expert Agent** - центральная база знаний (PostgreSQL + Qdrant)
- **Writer/Reviewer/Researcher/Interviewer** - специализированные агенты
- Нет промежуточного workflow engine

## Что было изменено

### 1. STATUS.md
- ❌ Удалено: "Модифицировать n8n workflow для Writer"
- ✅ Добавлено: "Интегрировать Expert Agent с Writer через Python API"
- ❌ Удален раздел: "### 4. Интеграция с n8n"
- ✅ Добавлен раздел: "### 4. Интеграция с другими агентами"

### 2. ARCHITECTURE.md
- ❌ Удалено из диаграммы: "n8n Workflows"
- ✅ Добавлено в диаграмму: "Expert Agent"
- ❌ Удален раздел: "#### n8n Workflows"
- ✅ Добавлен раздел: "#### Expert Agent"
- ❌ Удалено из User Registration Flow: упоминания n8n
- ❌ Удалено из Infrastructure таблицы: "n8n | Latest | Workflow automation"
- ✅ Добавлено в Infrastructure: "Qdrant | Latest | Vector database"

### 3. Файловая структура
- ❌ Удалена папка: `n8n-workflows/`
- ✅ Перемещена в архив: `doc/archive/n8n-workflows-deprecated-2025-10-17/`

## Новая архитектура интеграции агентов

```
┌─────────────────────────────────────────────────────────┐
│                  Business Logic Layer                    │
├─────────────────┬──────────────────┬───────────────────┤
│   AI Agents     │  Expert Agent    │  Core Services    │
│                 │  (PostgreSQL +   │                   │
│  - Writer       │   Qdrant)        │  - Grant Manager  │
│  - Reviewer     │                  │  - Anketa Manager │
│  - Researcher   │  Python API      │  - Notifications  │
│  - Interviewer  │  (прямые вызовы) │                   │
└─────────────────┴──────────────────┴───────────────────┘
```

### Протокол взаимодействия:
- **Формат:** Python dict / JSON
- **Протокол:** Прямые вызовы методов Python API
- **Timeout:** 30 секунд на запрос
- **Автоматизация:** Systemd services + Python скрипты

### Пример взаимодействия:
```python
# Writer получает знания от Expert Agent
from expert_agent import ExpertAgent

agent = ExpertAgent()
knowledge = agent.query_knowledge(
    question="Какие требования к названию проекта?",
    fund="fpg",
    top_k=5
)

# Writer использует знания для генерации текста
writer.generate_text(context=knowledge)
```

## Преимущества текущей архитектуры

### ✅ Плюсы (vs n8n):
1. **Простота** - нет дополнительного workflow engine
2. **Скорость** - прямые Python вызовы быстрее HTTP
3. **Типизация** - Python type hints вместо JSON schemas
4. **Отладка** - проще дебажить Python код
5. **Меньше зависимостей** - не нужен отдельный сервис n8n

### ⚠️ Что нужно будет сделать при масштабировании:
1. Рассмотреть очереди задач (Celery/RQ) для асинхронности
2. Добавить мониторинг вызовов между агентами
3. Внедрить rate limiting для защиты от перегрузок
4. Возможно, добавить API Gateway для унификации

## Рекомендации

### Для разработки:
- Используйте Python API напрямую между агентами
- Expert Agent - единая точка входа для знаний
- Systemd для автоматизации сервисов

### Для документации:
- Обновлена вся документация ✅
- При добавлении новых технологий - сначала внедряйте, потом документируйте
- Регулярно проверяйте соответствие документации реальности

## История изменений

| Дата | Что изменено | Причина |
|------|--------------|---------|
| 2025-10-17 | Удалены упоминания n8n из STATUS.md | n8n не используется |
| 2025-10-17 | Удалены упоминания n8n из ARCHITECTURE.md | n8n не используется |
| 2025-10-17 | Перемещена папка n8n-workflows в архив | Пустая папка, устаревшая |
| 2025-10-17 | Добавлен Expert Agent в документацию | Реальная архитектура |

---

**Заключение:** Документация теперь соответствует реальной архитектуре проекта. Все упоминания n8n удалены. Система использует systemd services + Python API для автоматизации.
