# Phase 1: System Prompt Update - Implementation

**Date:** 2025-10-22
**Status:** ✅ COMPLETED
**Time:** ~30 minutes

---

## Задача

Добавить в system_prompt список из 10-15 ключевых вопросов интервью, чтобы LLM знал всю структуру интервью заранее.

---

## Изменения

### Файл: `C:\SnowWhiteAI\GrantService\agents\reference_points\adaptive_question_generator.py`

**Строки:** 372-401

### До изменений:

```python
system_prompt = """Ты - эксперт по грантам Фонда президентских грантов (ФПГ).

Твоя задача - задать ОДИН уточняющий вопрос, чтобы получить нужную информацию о проекте.

ВАЖНО:
- Вопрос должен быть естественным, не шаблонным
- Адаптируй формулировку под уровень пользователя
- Используй контекст предыдущих ответов
- Не дублируй уже заданные вопросы
- Будь конкретным и понятным

Стиль:
- Для новичков: простые вопросы с подсказками
- Для экспертов: профессиональные термины, краткость
"""
```

### После изменений:

```python
system_prompt = """Ты - эксперт по грантам Фонда президентских грантов (ФПГ).

Твоя задача - провести структурированное интервью и собрать информацию о проекте.

ВСЕ КЛЮЧЕВЫЕ ВОПРОСЫ ИНТЕРВЬЮ (12 тем):
1. Имя заявителя - Как Ваше имя, как я могу к Вам обращаться?
2. Суть проекта - Расскажите о вашем проекте, в чем его суть и главная цель?
3. Проблема - Какую конкретную проблему решает ваш проект? Почему это важно?
4. Целевая аудитория - Кто ваша целевая аудитория? Сколько человек получат пользу?
5. География - В каком регионе будет реализован проект?
6. Методология - Как вы планируете реализовать проект? Какие конкретные мероприятия запланированы?
7. Результаты - Какие конкретные результаты и изменения вы планируете достичь?
8. Бюджет - Какой бюджет требуется? Как распределены средства по статьям?
9. Команда - Кто будет реализовывать проект? Какой у команды опыт? Есть ли партнеры?
10. Риски - Какие риски вы видите в проекте? Как планируете их минимизировать?
11. Устойчивость - Что будет с проектом после окончания гранта? Планируете ли развивать дальше?
12. Уникальность - Чем ваш проект отличается от других подобных инициатив?

ВАЖНО:
- Ты знаешь ВСЕ вопросы заранее, поэтому можешь делать естественные переходы
- Задавай ОДИН вопрос за раз, не дублируй уже заданные
- Адаптируй формулировку под уровень пользователя (новичок/эксперт)
- Используй контекст предыдущих ответов для естественного диалога
- Вопрос должен быть понятным и конкретным

Стиль:
- Для новичков: простые вопросы с подсказками
- Для экспертов: профессиональные термины, краткость
- Говори как живой человек, а не как анкета
"""
```

---

## Обоснование изменений

### Проблема:
- LLM не знал полной структуры интервью
- Каждый вопрос генерировался изолированно
- Невозможность планировать естественные переходы
- Риск дублирования вопросов

### Решение:
- Добавить полный список 12 ключевых тем в system_prompt
- LLM теперь видит всю картину интервью
- Может делать умные переходы и избегать дублирования

### Ожидаемые преимущества:

1. **Лучшее качество вопросов** - LLM понимает контекст всего интервью
2. **Естественные переходы** - "Отлично, а теперь давайте обсудим бюджет..."
3. **Нет дублирования** - LLM видит что уже спросил
4. **Адаптивность** - Может варьировать порядок в зависимости от ответов

---

## Соответствие Reference Points Framework

12 вопросов покрывают 8 Reference Points:

| Reference Point | Priority | Вопросы |
|----------------|----------|---------|
| understand_essence | P0 | #2 (Суть проекта) |
| identify_problem | P0 | #3 (Проблема) |
| find_target_audience | P0 | #4 (Целевая аудитория) |
| understand_methodology | P1 | #6 (Методология) |
| assess_budget | P1 | #8 (Бюджет) |
| understand_team | P1 | #9 (Команда) |
| identify_risks | P2 | #10 (Риски) |
| assess_sustainability | P2 | #11 (Устойчивость) |

**Дополнительные вопросы:**
- #1 - Имя заявителя (UX)
- #5 - География (важно для ФПГ)
- #7 - Результаты (индикаторы успеха)
- #12 - Уникальность (конкурентное преимущество)

---

## Следующие шаги (Phase 2)

1. Реализовать параллельную обработку Qdrant search
2. Использовать `asyncio.create_task()` для неблокирующего вызова
3. Добавить timeout (2 сек) для Qdrant с fallback
4. Измерить performance: цель 5-6 сек → 2-3 сек

---

## Тестирование

**TODO:** Создать тест для проверки:
- LLM получает новый system_prompt
- Генерируются качественные вопросы
- Нет дублирования
- Естественные переходы

**Тест файл:** `test_iteration_22_phase1.py`

---

**Status:** ✅ Phase 1 COMPLETED
**Next:** Phase 2 - Parallel Qdrant
