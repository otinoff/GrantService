# Iteration 24: Fix Duplicate Name Question - Implementation

**Date:** 2025-10-22
**Status:** ✅ COMPLETED
**Time:** ~15 minutes

---

## Проблема

Бот спрашивал имя **ДВА РАЗА**:
1. Hardcoded вопрос: "Скажите, как Ваше имя?" (Iteration 20)
2. LLM сгенерированный: "Здравствуйте! Как Ваше имя?" (Iteration 22)

**Root cause:** LLM не знал что имя уже собрано.

---

## Решение

Передавать имя в `collected_fields` чтобы LLM видел что информация уже есть.

---

## Изменения

### 1. `telegram-bot/main.py` (строки 1875-1879)

**Добавлено после получения имени:**

```python
# ✅ ITERATION 24: Отметить что имя УЖЕ СОБРАНО
user_data['collected_fields'] = {'applicant_name'}
user_data['covered_topics'] = ['applicant_name', 'greeting']
logger.info(f"[CONTEXT] Marked 'applicant_name' as collected")
```

### 2. `adaptive_question_generator.py` (строки 593-600)

**Уточнил инструкцию в system_prompt:**

```python
ВАЖНО:
- Ты знаешь ВСЕ вопросы заранее, поэтому можешь делать естественные переходы
- Задавай ОДИН вопрос за раз, не дублируй уже заданные
- ПРОВЕРЯЙ контекст: если информация УЖЕ СОБРАНА, НЕ спрашивай заново!  ← НОВОЕ
- Если имя известно, обращайся по имени для естественности  ← НОВОЕ
- Адаптируй формулировку под уровень пользователя
```

---

## Expected Result

### Before:
```
Bot: "Скажите, как Ваше имя?"
User: "Андрей"
Bot: "Здравствуйте! Как Ваше имя?" ❌ ДУБЛЬ!
```

### After:
```
Bot: "Скажите, как Ваше имя?"
User: "Андрей"
Bot: "Андрей, расскажите о вашем проекте..." ✅ ОБРАЩАЕТСЯ ПО ИМЕНИ!
```

---

## Bonus

Теперь LLM может:
- ✅ Обращаться к пользователю по имени
- ✅ Делать естественные переходы ("Андрей, а теперь давайте обсудим...")
- ✅ Не дублировать вопросы

---

**Status:** ✅ READY FOR TESTING
