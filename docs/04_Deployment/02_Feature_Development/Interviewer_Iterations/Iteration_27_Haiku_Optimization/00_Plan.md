# Iteration 27: Haiku Optimization + Simplified Architecture

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-23
**–°—Ç–∞—Ç—É—Å:** PLANNED
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** HIGH
**–í—Ä–µ–º—è:** ~4 —á–∞—Å–∞

---

## üéØ –¶–µ–ª—å

–£—Å–∫–æ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä –≤ **3-4 —Ä–∞–∑–∞** –∏ —É–¥–µ—à–µ–≤–∏—Ç—å –≤ **10 —Ä–∞–∑** —á–µ—Ä–µ–∑:
1. –ü–µ—Ä–µ—Ö–æ–¥ —Å Sonnet 4.5 –Ω–∞ Haiku 3.5
2. –£–ø—Ä–æ—â–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—É–±—Ä–∞—Ç—å Qdrant –∏–∑ hot path)
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

---

## üí° –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ

### –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:
- –í–æ–ø—Ä–æ—Å—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è 5-8 —Å–µ–∫—É–Ω–¥
- User feedback: "–º–µ–¥–ª–µ–Ω–Ω–æ–≤–∞—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –∏–¥—É—Ç"
- –î–æ—Ä–æ–≥–æ (~$0.02 –Ω–∞ –≤–æ–ø—Ä–æ—Å)
- –°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Qdrant semantic search –∫–∞–∂–¥—ã–π —Ä–∞–∑)

### –ò–Ω—Å–∞–π—Ç:
**–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä - —ç—Ç–æ —Å–±–æ—Ä—â–∏–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å!**

–ï–º—É –Ω–µ –Ω—É–∂–Ω–æ:
- ‚ùå Semantic search –ø–æ 100 –ø—Ä–∏–º–µ—Ä–∞–º –∫–∞–∂–¥—ã–π —Ä–∞–∑
- ‚ùå –°–ª–æ–∂–Ω–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ (Sonnet overkill)
- ‚ùå –¢–≤–æ—Ä—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

–ï–º—É –Ω—É–∂–Ω–æ:
- ‚úÖ –ó–Ω–∞—Ç—å 13 reference points (—Å—Ç–∞—Ç–∏—á–Ω–æ –≤ –ø—Ä–æ–º–ø—Ç–µ)
- ‚úÖ –í–∏–¥–µ—Ç—å —á—Ç–æ —Å–æ–±—Ä–∞–Ω–æ / —á—Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç
- ‚úÖ –ó–∞–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –ª–æ–≥–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å
- ‚úÖ –ü–µ—Ä–µ—Å–ø—Ä–æ—Å–∏—Ç—å –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ–ø–æ–ª–Ω—ã–π

**–î–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Haiku!**

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### Performance:
| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ (Sonnet) | –ü–æ—Å–ª–µ (Haiku) | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-------------|---------------|-----------|
| Latency –Ω–∞ –≤–æ–ø—Ä–æ—Å | 5-8s | 1.5-2s | **-60-75%** |
| Cost –Ω–∞ –≤–æ–ø—Ä–æ—Å | ~$0.02 | ~$0.002 | **-90%** |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | –°–ª–æ–∂–Ω–∞—è | –ü—Ä–æ—Å—Ç–∞—è | –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å |

### Quality:
- –û–∂–∏–¥–∞–µ—Ç—Å—è: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è (–¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö)
- –†–∏—Å–∫: –º–æ–∂–µ—Ç –±—ã—Ç—å —á—É—Ç—å –º–µ–Ω–µ–µ "—É–º–Ω–∞—è" –¥–ª—è edge cases
- Mitigation: A/B —Ç–µ—Å—Ç, fallback –Ω–∞ Sonnet –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### ‚ùå –¢–µ–∫—É—â–∞—è (Iteration 26):
```
–ù–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å:
‚îú‚îÄ Qdrant semantic search: 0.5-1s
‚îÇ  ‚îî‚îÄ –ü–æ–∏—Å–∫ –ø–æ 100+ –ø—Ä–∏–º–µ—Ä–∞–º –≤–æ–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ Gaps analysis: 0.5s
‚îÇ  ‚îî‚îÄ –ö–∞–∫–∏–µ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
‚îú‚îÄ Sonnet LLM: 4-6s
‚îÇ  ‚îî‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
‚îî‚îÄ Total: 5-8s

Cost: $0.02 per question
```

### ‚úÖ –ù–æ–≤–∞—è (Iteration 27):
```
–ù–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å:
‚îú‚îÄ Static structure in prompt: 0s
‚îÇ  ‚îî‚îÄ 13 reference points –æ–ø–∏—Å–∞–Ω—ã –≤ –ø—Ä–æ–º–ø—Ç–µ
‚îú‚îÄ Gaps analysis: 0.5s
‚îÇ  ‚îî‚îÄ –ö–∞–∫–∏–µ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
‚îú‚îÄ Haiku LLM: 1-1.5s
‚îÇ  ‚îî‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–∞ (–ø—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞)
‚îî‚îÄ Total: 1.5-2s

Cost: $0.002 per question
```

**–ß—Ç–æ —É–±–∏—Ä–∞–µ–º:**
- ‚ùå Qdrant semantic search –∏–∑ hot path
- ‚ùå –°–ª–æ–∂–Ω—ã–π prompt —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- ‚ùå Sonnet (overkill –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏)

**–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º:**
- ‚úÖ –°—Ç–∞—Ç–∏—á–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 13 reference points –≤ –ø—Ä–æ–º–ø—Ç–µ
- ‚úÖ –ß–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Haiku
- ‚úÖ –¢–æ–ø-10 –ø—Ä–∏–º–µ—Ä–æ–≤ –≤—à–∏—Ç—ã –≤ –ø—Ä–æ–º–ø—Ç (–±–µ–∑ –ø–æ–∏—Å–∫–∞)

---

## üìã –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### Phase 1: Switch to Haiku (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –º–æ–¥–µ–ª—å —Å Sonnet –Ω–∞ Haiku

**–§–∞–π–ª—ã:**
```python
# C:\SnowWhiteAI\GrantService\agents\reference_points\adaptive_question_generator.py

# –ë—ã–ª–æ:
LLM_MODEL = "claude-3-5-sonnet-20241022"

# –°—Ç–∞–ª–æ:
LLM_MODEL = "claude-3-5-haiku-20241022"
```

**–¢–µ—Å—Ç:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å latency: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~1.5-2s
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Ö–æ—Ä–æ—à–æ?

---

### Phase 2: Remove Qdrant from hot path (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞:** –£–±—Ä–∞—Ç—å semantic search, –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –ø—Ä–æ–º–ø—Ç

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**–£–±—Ä–∞—Ç—å:**
```python
# adaptive_question_generator.py: _get_fpg_context()
# –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ª–∞–µ—Ç semantic search –≤ Qdrant –∫–∞–∂–¥—ã–π —Ä–∞–∑
# –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞!
```

**–î–æ–±–∞–≤–∏—Ç—å:**
```python
REFERENCE_POINTS_STRUCTURE = """
–ì—Ä–∞–Ω—Ç–æ–≤–∞—è –∞–Ω–∫–µ—Ç–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 13 –ø–æ–ª–µ–π (Reference Points):

rp_001: –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (–∫—Ä–∞—Ç–∫–æ–µ, –ø–æ–Ω—è—Ç–Ω–æ–µ)
rp_002: –°—É—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –æ—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è)
rp_003: –ü—Ä–æ–±–ª–µ–º–∞ (–∫–∞–∫—É—é —Å–æ—Ü–∏–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É —Ä–µ—à–∞–µ—Ç)
rp_004: –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è (–∫—Ç–æ –ø–æ–ª—É—á–∏—Ç –ø–æ–ª—å–∑—É)
rp_005: –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (–≥–¥–µ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)
rp_006: –¶–µ–ª–∏ (—á–µ–≥–æ —Ö–æ—Ç–∏–º –¥–æ—Å—Ç–∏—á—å)
rp_007: –ó–∞–¥–∞—á–∏ (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏)
rp_008: –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è (—á—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å)
rp_009: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (—á—Ç–æ –ø–æ–ª—É—á–∏–º)
rp_010: –ü–∞—Ä—Ç–Ω–µ—Ä—ã (–∫—Ç–æ –ø–æ–º–æ–∂–µ—Ç)
rp_011: –ö–æ–º–∞–Ω–¥–∞ (–∫—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç)
rp_012: –ë—é–¥–∂–µ—Ç (—Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ)
rp_013: –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (—á—Ç–æ –±—É–¥–µ—Ç –ø–æ—Å–ª–µ –≥—Ä–∞–Ω—Ç–∞)

–ü–†–ò–ú–ï–†–´ –•–û–†–û–®–ò–• –í–û–ü–†–û–°–û–í:
- "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, –≤ —á–µ–º —Å—É—Ç—å –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞?"
- "–ö–∞–∫—É—é —Å–æ—Ü–∏–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–µ—à–∏—Ç—å?"
- "–ö—Ç–æ –≤–∞—à–∞ —Ü–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è? –°–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –æ—Ö–≤–∞—Ç–∏—Ç—å?"
- "–ì–¥–µ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ–µ–∫—Ç? –í –∫–∞–∫–æ–º –≥–æ—Ä–æ–¥–µ/—Ä–µ–≥–∏–æ–Ω–µ?"
"""

# –í—à–∏—Ç—å –≤ –ø—Ä–æ–º–ø—Ç –∫ Haiku
```

**–¢–µ—Å—Ç:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å –±–µ–∑ Qdrant
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Haiku –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- Latency –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –µ—â—ë –º–µ–Ω—å—à–µ (~1.5s)

---

### Phase 3: Optimize prompts for Haiku (1 —á–∞—Å)

**–ó–∞–¥–∞—á–∞:** –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –ø–æ–¥ Haiku (–∫–æ—Ä–æ—á–µ, –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ)

**–ü—Ä–∏–Ω—Ü–∏–ø—ã –¥–ª—è Haiku:**
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ —á–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
- ‚úÖ –ë–µ–∑ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

**–ü—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞:**
```python
prompt = f"""
–¢—ã –∏–Ω—Ç–µ—Ä–≤—å—é–µ—Ä –¥–ª—è –≥—Ä–∞–Ω—Ç–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫. –ü–æ–º–æ–≥–∞–µ—à—å —Å–æ–±—Ä–∞—Ç—å 13 –ø–æ–ª–µ–π –∞–Ω–∫–µ—Ç—ã.

{REFERENCE_POINTS_STRUCTURE}

–ß–¢–û –£–ñ–ï –°–û–ë–†–ê–ù–û:
{collected_fields_summary}

–ß–¢–û –ï–©–Å –ù–£–ñ–ù–û:
{missing_fields_list}

–ü–û–°–õ–ï–î–ù–ò–ô –û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
"{user_answer}"

–ò–ù–°–¢–†–£–ö–¶–ò–Ø:
1. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ–ø–æ–ª–Ω—ã–π/–Ω–µ—è—Å–Ω—ã–π ‚Üí –ø–µ—Ä–µ—Å–ø—Ä–æ—Å–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ (—á—Ç–æ –∏–º–µ–Ω–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å)
2. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–º ‚Üí –º—è–≥–∫–æ —É–∫–∞–∂–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–µ
3. –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø–æ–ª–æ–Ω ‚Üí –ø–µ—Ä–µ–π–¥–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–ª—é –∏–∑ —Å–ø–∏—Å–∫–∞ "–ß—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ"
4. –ë—É–¥—å –∫—Ä–∞—Ç–∫–∏–º, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º, –≤–µ–∂–ª–∏–≤—ã–º
5. –ù–µ —Ñ–∏–ª–æ—Å–æ—Ñ—Å—Ç–≤—É–π - –ø–æ–º–æ–≥–∞–π —Å–æ–±—Ä–∞—Ç—å —Ñ–∞–∫—Ç—ã

–ó–∞–¥–∞–π —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å (–æ–¥–Ω—É —Ñ—Ä–∞–∑—É, –±–µ–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏):
"""
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**
- –°—Ç–∞—Ä—ã–π –ø—Ä–æ–º–ø—Ç —Å Sonnet: ~2000 —Ç–æ–∫–µ–Ω–æ–≤ (—Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏–∑ Qdrant)
- –ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å Haiku: ~500 —Ç–æ–∫–µ–Ω–æ–≤ (—Å—Ç–∞—Ç–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

**–≠–∫–æ–Ω–æ–º–∏—è:** -75% tokens, -75% cost, -50% latency

---

### Phase 4: Testing (1 —á–∞—Å)

**E2E Test:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ –∞–Ω–∫–µ—Ç—É –ï–∫–∞—Ç–µ—Ä–∏–Ω—ã –ú–∞–∫—Å–∏–º–æ–≤–æ–π
# test_real_anketa_e2e.py

# –ú–µ—Ç—Ä–∏–∫–∏:
- Total time: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~40-50s (–±—ã–ª–æ 108s)
- Latency per question: 1.5-2s (–±—ã–ª–æ 5-8s)
- Quality: —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
```

**Unit Tests:**
```python
# test_haiku_question_generation.py

def test_haiku_generates_relevant_question():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Haiku –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å"""

def test_haiku_handles_short_answers():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Haiku –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–∞ –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã"""

def test_haiku_performance():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å latency < 2.5s"""
```

**Acceptance Criteria:**
- ‚úÖ Latency < 2.5s per question
- ‚úÖ E2E test –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ Quality –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏–µ–º–ª–µ–º–∞—è (subjective)
- ‚úÖ User happy ("–Ω–µ –º–µ–¥–ª–µ–Ω–Ω–æ–≤–∞—Ç–æ!")

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –†–∏—Å–∫ 1: Haiku –º–æ–∂–µ—Ç –±—ã—Ç—å "–≥–ª—É–ø–µ–µ" —á–µ–º Sonnet

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (30%)

**–ü—Ä–æ—è–≤–ª–µ–Ω–∏–µ:**
- –í–æ–ø—Ä–æ—Å—ã –º–µ–Ω–µ–µ —É–º–Ω—ã–µ
- –ù–µ –ª–æ–≤–∏—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è
- –ù–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

**Mitigation:**
1. **A/B Test:** –ó–∞–ø—É—Å—Ç–∏—Ç—å 5 –∏–Ω—Ç–µ—Ä–≤—å—é —Å Haiku, –æ—Ü–µ–Ω–∏—Ç—å quality
2. **Fallback:** –ï—Å–ª–∏ quality –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞:
   - Haiku –¥–ª—è simple questions (80% —Å–ª—É—á–∞–µ–≤)
   - Sonnet –¥–ª—è complex reasoning (20% —Å–ª—É—á–∞–µ–≤)
   - Automatic routing –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

### –†–∏—Å–∫ 2: –ü–æ—Ç–µ—Ä—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–∑ Qdrant —É—Ö—É–¥—à–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (20%)

**–ü—Ä–æ—è–≤–ª–µ–Ω–∏–µ:**
- –í–æ–ø—Ä–æ—Å—ã —à–∞–±–ª–æ–Ω–Ω—ã–µ
- –ù–µ —É—á–∏—Ç—ã–≤–∞—é—Ç best practices

**Mitigation:**
1. –í–∑—è—Ç—å —Ç–æ–ø-10 –ª—É—á—à–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏–∑ Qdrant
2. –í—à–∏—Ç—å –≤ –ø—Ä–æ–º–ø—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏
3. Haiku —É–≤–∏–¥–∏—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –±–µ–∑ semantic search

### –†–∏—Å–∫ 3: –†–µ–≥—Ä–µ—Å—Å–∏—è –≤ production

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (10%)

**Mitigation:**
1. –ü–æ–ª–Ω–æ–µ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
2. Canary deployment (50% traffic)
3. Rollback plan –≥–æ—Ç–æ–≤

---

## üîÑ Rollback Plan

**–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**

```bash
# Git rollback
git revert <commit_hash>

# Deploy
./deploy_to_production.sh

# Downtime: ~3 seconds
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è rollback:**
- Latency > 5s (—Ö—É–∂–µ —á–µ–º –±—ã–ª–æ)
- Error rate > 5%
- User complaints
- Quality —è–≤–Ω–æ —Ö—É–∂–µ

---

## üìä Success Metrics

### Performance:
- ‚úÖ Latency per question: 1.5-2s (target)
- ‚úÖ E2E interview: 40-50s total (–±—ã–ª–æ 108s)
- ‚úÖ Cost per interview: -90%

### Quality:
- ‚úÖ Questions relevant (subjective)
- ‚úÖ Detects short/gibberish answers
- ‚úÖ Completes interview successfully
- ‚úÖ Audit score ‚â• 8/10

### Business:
- ‚úÖ User satisfaction: "–±—ã—Å—Ç—Ä–æ!"
- ‚úÖ Completion rate ‚â• 90%
- ‚úÖ No increase in dropout rate

---

## üóÇÔ∏è –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

### Core:
```
C:\SnowWhiteAI\GrantService\agents\reference_points\
‚îú‚îÄ‚îÄ adaptive_question_generator.py
‚îÇ   ‚îú‚îÄ‚îÄ –ò–∑–º–µ–Ω–∏—Ç—å: LLM_MODEL = "haiku"
‚îÇ   ‚îú‚îÄ‚îÄ –£–±—Ä–∞—Ç—å: _get_fpg_context() –∏–∑ hot path
‚îÇ   ‚îî‚îÄ‚îÄ –î–æ–±–∞–≤–∏—Ç—å: REFERENCE_POINTS_STRUCTURE
```

### Tests:
```
C:\SnowWhiteAI\GrantService\tests\
‚îú‚îÄ‚îÄ integration\
‚îÇ   ‚îî‚îÄ‚îÄ test_haiku_question_generation.py (new)
‚îî‚îÄ‚îÄ e2e\
    ‚îî‚îÄ‚îÄ test_real_anketa_haiku.py (modify existing)
```

### Documentation:
```
C:\SnowWhiteAI\GrantService_Project\Development\02_Feature_Development\Interviewer_Iterations\Iteration_27_Haiku_Optimization\
‚îú‚îÄ‚îÄ 00_Plan.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
‚îú‚îÄ‚îÄ 01_Implementation_Report.md (–ø–æ—Å–ª–µ Phase 1-3)
‚îú‚îÄ‚îÄ 02_Test_Results.md (–ø–æ—Å–ª–µ Phase 4)
‚îî‚îÄ‚îÄ 03_Final_Report.md (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è)
```

---

## üí∞ ROI Analysis

### Cost Savings:
```
Baseline (Sonnet):
- 10 questions per interview
- $0.02 per question
- Total: $0.20 per interview
- 100 interviews/month = $20/month

After Haiku:
- 10 questions per interview
- $0.002 per question
- Total: $0.02 per interview
- 100 interviews/month = $2/month

SAVINGS: $18/month = $216/year
```

### Time Savings (User):
```
Baseline:
- 10 questions √ó 8s = 80s waiting
- User perception: "–º–µ–¥–ª–µ–Ω–Ω–æ–≤–∞—Ç–æ"

After Haiku:
- 10 questions √ó 2s = 20s waiting
- User perception: "–±—ã—Å—Ç—Ä–æ!"

IMPROVEMENT: -75% perceived latency
```

### Development Time:
```
Investment: 4 hours
ROI: Infinite (improved UX, lower costs forever)
```

---

## üéØ Next Steps

### Immediate:
1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç –ø–ª–∞–Ω
2. –û–±—Å—É–¥–∏—Ç—å —Å –∫–æ–º–∞–Ω–¥–æ–π
3. –†–µ—à–∏—Ç—å: –¥–µ–ª–∞—Ç—å –∏–ª–∏ –Ω–µ –¥–µ–ª–∞—Ç—å?

### If GO:
1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É `iteration-27-haiku`
2. Phase 1: Switch to Haiku (1h)
3. Phase 2: Remove Qdrant (1h)
4. Phase 3: Optimize prompts (1h)
5. Phase 4: Testing (1h)
6. Deploy to production

### If NO-GO:
1. Alternative: Question Prefetching (Iteration 27 original plan)
2. Keep Sonnet, –Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –≤ —Ñ–æ–Ω–µ

---

## üìö References

**Related Documents:**
- `ITERATION_26.3_COMPLETE_SUMMARY.md` - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `Architecture_Analysis_Question_Generation.md` - –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `Strategy/00_Methodology/CLAUDE-SKILLS-METHODOLOGY.md` - –ü—Ä–∏–Ω—Ü–∏–ø "200 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 5000"

**User Feedback:**
> "—Å—É–ø–µ—Ä –º–µ–≥–∞!!! —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç"
> "–º–µ–¥–ª–µ–Ω–Ω–æ–≤–∞—Ç–æ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–≤–µ—Ç—ã –∏–¥—É—Ç"
> "–º–æ–∂–Ω–æ –∫–∞–∫ —Ç–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –æ–ø–µ—Ä–µ–∂–µ–Ω–∏–µ?"

**Decision:** Haiku + Simple Architecture –≤–º–µ—Å—Ç–æ Prefetching

---

## üí° –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏—Ç–µ—Ä–∞—Ü–∏–∏

**–ü—Ä–∏–Ω—Ü–∏–ø Cradle OS:**
> "200 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 5000"

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –£–±–∏—Ä–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å (Qdrant search)
- –£–ø—Ä–æ—â–∞–µ–º –º–æ–¥–µ–ª—å (Haiku –≤–º–µ—Å—Ç–æ Sonnet)
- –°—Ç–∞—Ç–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–º–µ—Å—Ç–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–æ—â–µ, –±—ã—Å—Ç—Ä–µ–µ, –¥–µ—à–µ–≤–ª–µ

**–ò–Ω—Å–∞–π—Ç:**
> "–ò–Ω—Ç–µ—Ä–≤—å—é–µ—Ä - —ç—Ç–æ –Ω–µ —Ñ–∏–ª–æ—Å–æ—Ñ, —ç—Ç–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç-—Å–±–æ—Ä—â–∏–∫ –¥–∞–Ω–Ω—ã—Ö"

–ï–º—É –Ω–µ –Ω—É–∂–µ–Ω Sonnet. –ï–º—É –Ω—É–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞.

---

**–°—Ç–∞—Ç—É—Å:** READY TO START
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** HIGH
**–í—Ä–µ–º—è:** 4 hours
**–†–∏—Å–∫:** LOW-MEDIUM
**ROI:** EXCELLENT

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û–±—Å—É–¥–∏—Ç—å —Å—Ä–æ—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –ø–æ—Ç–æ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —ç—Ç–æ–º—É –ø–ª–∞–Ω—É! üöÄ

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-10-23
**–ê–≤—Ç–æ—Ä:** Claude Code AI Assistant
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** PLANNED
