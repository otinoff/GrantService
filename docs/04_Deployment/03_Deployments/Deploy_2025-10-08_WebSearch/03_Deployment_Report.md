# üöÄ WebSearch Deployment Report

**–î–∞—Ç–∞**: 2025-10-08
**–°–µ—Ä–≤–µ—Ä**: 178.236.17.55
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Deployment —É—Å–ø–µ—à–Ω—ã–π, ‚ùå WebSearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

1. **–°–æ–∑–¥–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π wrapper** —Å WebSearch –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
   - –§–∞–π–ª: `claude-api-wrapper-v2.py`
   - –†–∞–∑–º–µ—Ä: 21KB (vs —Å—Ç–∞—Ä—ã–π 15KB)
   - –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏: `WebSearchRequest`, `WebSearchResponse`
   - –ù–æ–≤—ã–π –º–µ—Ç–æ–¥: `ClaudeCodeInterface.websearch()`
   - –ù–æ–≤—ã–π endpoint: `POST /websearch`

2. **–ó–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä**
   - SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ‚úÖ
   - –ë—ç–∫–∞–ø —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞: ‚úÖ
   - –ó–∞–º–µ–Ω–∞ —Ñ–∞–π–ª–∞: ‚úÖ
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞: ‚úÖ
   - PID –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞: 62629

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã endpoint'—ã**
   - `GET /health`: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
   - `POST /websearch`: ‚úÖ Endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ WebSearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

---

## ‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### Claude Code –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ù–ï –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ WebSearch

**–û—à–∏–±–∫–∞:**
```json
{
  "snippet": "I don't have permission to use the WebSearch tool"
}
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-10-12):

**Claude Code CLI —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è WebSearch tool**

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ pipe) ‚Üí –∑–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è ‚Üí –æ—à–∏–±–∫–∞ "I don't have permission"

**–†–µ—à–µ–Ω–∏–µ**: –§–ª–∞–≥ `--dangerously-skip-permissions` –æ—Ç–∫–ª—é—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

### ~~–ù–µ–≤–µ—Ä–Ω—ã–µ –≥–∏–ø–æ—Ç–µ–∑—ã~~ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å):

1. ~~OAuth —Ç–æ–∫–µ–Ω –Ω–µ –∏–º–µ–µ—Ç WebSearch scopes~~ - –ù–ï–í–ï–†–ù–û
   - Scopes: `user:inference`, `user:profile` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã
   - WebSearch –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π scope

2. ~~–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è~~ - –ù–ï–í–ï–†–ù–û
   - –°–µ—Ä–≤–µ—Ä –≤ –®–≤–µ—Ü–∏–∏ - –ù–ï –ø—Ä–æ–±–ª–µ–º–∞
   - WebSearch —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –ª—é–±–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞

3. ~~Subscription Type~~ - –ù–ï–í–ï–†–ù–û
   - Max (20x rate limits) –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebSearch
   - –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –õ–æ–∫–∞–ª—å–Ω–æ vs –°–µ—Ä–≤–µ—Ä

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –í–∞—à –ü–ö (Windows) | –°–µ—Ä–≤–µ—Ä (178.236.17.55) |
|----------|------------------|------------------------|
| **WebSearch** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω |
| **Region** | ? | –®–≤–µ—Ü–∏—è |
| **OAuth scopes** | user:inference, user:profile | user:inference, user:profile |
| **Subscription** | Max (20x) | Max (20x) |

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-10-12)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –§–ª–∞–≥ --dangerously-skip-permissions (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã permissions**:
```bash
echo "prompt" | claude --dangerously-skip-permissions
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û—Ç–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
- WebSearch —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
```python
# –í claude-api-wrapper.py —Å—Ç—Ä–æ–∫–∞ 179:
command = f'echo "{escaped_message}" | claude --dangerously-skip-permissions'
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ deployment (—Å–º. WEBSEARCH_FIX_DEPLOYMENT_INSTRUCTIONS.md)

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: Perplexity API (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –ª—é–±–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ø–æ–∏—Å–∫–µ
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–æ–º–µ–Ω–∞–º
- ‚úÖ –¶–∏—Ç–∞—Ç—ã –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- $0.01 –∑–∞ –∑–∞–ø—Ä–æ—Å
- $0.27 –Ω–∞ –∞–Ω–∫–µ—Ç—É (27 –∑–∞–ø—Ä–æ—Å–æ–≤ √ó $0.01)
- ~$27/–º–µ—Å—è—Ü –ø—Ä–∏ 100 –∞–Ω–∫–µ—Ç–∞—Ö

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```python
# agents/researcher_agent.py
from perplexity import PerplexityClient

researcher = ResearcherAgent(db, llm_provider="perplexity")
result = await researcher.research_anketa(anketa_id)
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: VPN —á–µ—Ä–µ–∑ –°–®–ê

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å VPN –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (OpenVPN/WireGuard)
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ US —Å–µ—Ä–≤–µ—Ä
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Claude Code wrapper
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å WebSearch

**–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- VPN —Å–µ—Ä–≤–∏—Å: ~$5-10/–º–µ—Å—è—Ü

**–†–∏—Å–∫–∏:**
- –ú–æ–∂–µ—Ç –Ω–µ –ø–æ–º–æ—á—å (–µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ OAuth scopes)
- –£–≤–µ–ª–∏—á–∏—Ç –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 3: Google Custom Search API

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –ª—é–±–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞

**–°—Ç–æ–∏–º–æ—Å—Ç—å:**
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ: 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
- –ü–ª–∞—Ç–Ω–æ: $5 –∑–∞ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ RU-–¥–æ–º–µ–Ω–∞–º
- ‚ùå –ú–µ–Ω–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Perplexity API**

### –ü–æ—á–µ–º—É:
1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏–∑ –ª—é–±–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞
2. **–ö–∞—á–µ—Å—Ç–≤–æ** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ø–æ–∏—Å–∫–µ –∏ –∞–Ω–∞–ª–∏–∑–µ
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç allowed_domains –¥–ª—è RU-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
4. **–¶–µ–Ω–∞** - $0.27 –Ω–∞ –∞–Ω–∫–µ—Ç—É –ø—Ä–∏–µ–º–ª–µ–º–æ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≥—Ä–∞–Ω—Ç–∞
5. **–ì–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VPN

### –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

#### –≠—Ç–∞–ø 1: –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á (5 –º–∏–Ω)
```
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ perplexity.ai
2. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á
3. –î–æ–±–∞–≤–∏—Ç—å –≤ .env: PERPLEXITY_API_KEY=xxx
```

#### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ Researcher (1 —á–∞—Å)
```python
# agents/researcher_agent.py
class ResearcherAgent(BaseAgent):
    def __init__(self, db, llm_provider: str = "perplexity"):
        self.perplexity_api_key = os.getenv('PERPLEXITY_API_KEY')

    async def websearch(self, query: str, domains: List[str]):
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º Perplexity API
        ...
```

#### –≠—Ç–∞–ø 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (30 –º–∏–Ω)
```bash
pytest tests/integration/test_researcher_perplexity.py
```

#### –≠—Ç–∞–ø 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –∞–Ω–∫–µ—Ç–µ –í–∞–ª–µ—Ä–∏–∏ (5 –º–∏–Ω)
```bash
python telegram-bot/test_researcher_logging.py --anketa-id AN-20250905-Valeria_bruzzzz-001
```

---

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
GrantService
    ‚Üì
Researcher Agent
    ‚Üì
Perplexity API (–ù–ï Claude Code WebSearch!)
    ‚Üì
27 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    ‚Üì
research_results (JSONB)
    ‚Üì
Writer Agent ‚Üí Grant —Å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º
```

---

## üîß Deployment Details

### –°–µ—Ä–≤–µ—Ä
- IP: 178.236.17.55
- Hostname: ctytdjxzil
- User: root

### –ü—Ä–æ—Ü–µ—Å—Å
- PID: 62629
- Command: `/opt/claude-api/venv/bin/python3 /opt/claude-api/claude-api-wrapper.py`
- Status: ‚úÖ Running
- Port: 8000

### –§–∞–π–ª—ã
- Wrapper: `/opt/claude-api/claude-api-wrapper.py` (21KB)
- Backup: `/opt/claude-api/claude-api-wrapper.py.backup-20251008-*`
- Logs: `/var/log/claude-api.log`

### Endpoints
- `GET /`: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- `GET /health`: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (features: chat, code, websearch)
- `POST /chat`: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- `POST /code`: ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- `POST /websearch`: ‚úÖ Endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç, WebSearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

---

## üìä –ò—Ç–æ–≥–∏

### ‚úÖ –£—Å–ø–µ—à–Ω–æ:
1. Wrapper –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ v2.0.0 —Å WebSearch –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
2. Deployment –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω
3. –í—Å–µ endpoint'—ã —Ä–∞–±–æ—Ç–∞—é—Ç
4. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ WebSearch

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã:
1. Claude Code WebSearch –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞

### üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Perplexity API
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∞–Ω–∫–µ—Ç–µ –í–∞–ª–µ—Ä–∏–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Researcher –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ Auditor
4. –û–±–Ω–æ–≤–∏—Ç—å Writer –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è research_results

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- –°–µ—Ä–≤–µ—Ä: root@178.236.17.55
- API: http://178.236.17.55:8000
- API Key: 1f79b062cf00b8d28546f5bd283dc59a1c6a7f9e9fe5a8e5ef25b0cc27aa0732

---

**–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞**: 2025-10-08 12:50 UTC
**–ê–≤—Ç–æ—Ä**: AI Integration Specialist
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Deployment –∑–∞–≤–µ—Ä—à–µ–Ω, –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Perplexity
