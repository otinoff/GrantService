#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö –∏–Ω—Ç–µ—Ä–≤—å—é
"""

import os
import sys
import sqlite3

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—é –ë–î
sys.path.append('/var/GrantService')

from data.database import db, get_interview_questions

def check_and_fix_hints():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö"""
    
    print("=" * 50)
    print("–ü–†–û–í–ï–†–ö–ê –ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–î–°–ö–ê–ó–û–ö")
    print("=" * 50)
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
    questions = get_interview_questions()
    
    print(f"\n–ù–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤: {len(questions)}")
    print("-" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å
    questions_without_hints = []
    for q in questions:
        question_num = q.get('question_number')
        question_text = q.get('question_text')[:50]
        hint = q.get('hint_text')
        
        if hint and hint.strip():
            print(f"‚úÖ –í–æ–ø—Ä–æ—Å {question_num}: –ï–°–¢–¨ –ø–æ–¥—Å–∫–∞–∑–∫–∞")
            print(f"   –¢–µ–∫—Å—Ç: {question_text}...")
            print(f"   –ü–æ–¥—Å–∫–∞–∑–∫–∞: {hint[:100]}...")
        else:
            print(f"‚ùå –í–æ–ø—Ä–æ—Å {question_num}: –ù–ï–¢ –ø–æ–¥—Å–∫–∞–∑–∫–∏!")
            print(f"   –¢–µ–∫—Å—Ç: {question_text}...")
            questions_without_hints.append(question_num)
    
    # –ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö
    if questions_without_hints:
        print("\n" + "=" * 50)
        print(f"‚ö†Ô∏è –ù–ê–ô–î–ï–ù–û {len(questions_without_hints)} –í–û–ü–†–û–°–û–í –ë–ï–ó –ü–û–î–°–ö–ê–ó–û–ö")
        print("–î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏...")
        
        # –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –≤—Å–µ—Ö 14 –≤–æ–ø—Ä–æ—Å–æ–≤
        hints_data = {
            1: "–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞. –û–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º –∏ –æ—Ç—Ä–∞–∂–∞—Ç—å —Å—É—Ç—å –≤–∞—à–µ–π –∏–¥–µ–∏. –ù–∞–ø—Ä–∏–º–µ—Ä: '–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–¥–æ—Ä–æ–≤—å—è –ø–æ–∂–∏–ª—ã—Ö –ª—é–¥–µ–π'",
            2: "–û–ø–∏—à–∏—Ç–µ –≥–ª–∞–≤–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ—Ç –≤–∞—à –ø—Ä–æ–µ–∫—Ç. –ö–∞–∫–∞—è –±–æ–ª—å –∏–ª–∏ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –µ—Å—Ç—å —É –≤–∞—à–µ–π —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏? –ü–æ—á–µ–º—É —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤–∞–∂–Ω–∞?",
            3: "–ö—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∞—à –ø—Ä–æ–¥—É–∫—Ç? –û–ø–∏—à–∏—Ç–µ –ø–æ—Ä—Ç—Ä–µ—Ç —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –≤–æ–∑—Ä–∞—Å—Ç, –∏–Ω—Ç–µ—Ä–µ—Å—ã, –ø—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç",
            4: "–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ. –ö—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–∞–≤? –ö–∞–∫–æ–π –æ–ø—ã—Ç –∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏ –µ—Å—Ç—å —É —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤? –ö–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ä–æ–ª–∏?",
            5: "–ö–∞–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã –≤–∞–º –Ω—É–∂–Ω—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞? –°–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥, –≤—Ä–µ–º–µ–Ω–∏, –∫–∞–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—Å—è?",
            6: "–û–ø–∏—à–∏—Ç–µ –≤–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ. –ö–∞–∫ –∏–º–µ–Ω–Ω–æ –≤–∞—à –ø—Ä–æ–¥—É–∫—Ç —Ä–µ—à–∞–µ—Ç –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É? –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç?",
            7: "–ß–µ–º –≤–∞—à –ø—Ä–æ–µ–∫—Ç –ª—É—á—à–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–Ω–∞–ª–æ–≥–æ–≤? –ö–∞–∫–∏–µ —É –≤–∞—Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞? –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –≤–∞—Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏?",
            8: "–ö–∞–∫ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å? –û–ø–∏—à–∏—Ç–µ –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å: –∫—Ç–æ –±—É–¥–µ—Ç –ø–ª–∞—Ç–∏—Ç—å, –∑–∞ —á—Ç–æ –∏ —Å–∫–æ–ª—å–∫–æ?",
            9: "–ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞? –†–∞—Å–ø–∏—à–∏—Ç–µ –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ä–æ–∫–æ–≤ –∏ –∫–ª—é—á–µ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤",
            10: "–ö–∞–∫–∏–µ —Ä–∏—Å–∫–∏ –º–æ–≥—É—Ç –ø–æ–º–µ—à–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞? –ö–∞–∫ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Ö –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å?",
            11: "–ö–∞–∫–æ–µ –≤–ª–∏—è–Ω–∏–µ –æ–∫–∞–∂–µ—Ç –≤–∞—à –ø—Ä–æ–µ–∫—Ç? –ö–∞–∫—É—é –ø–æ–ª—å–∑—É –æ–Ω –ø—Ä–∏–Ω–µ—Å–µ—Ç –æ–±—â–µ—Å—Ç–≤—É, —ç–∫–æ–Ω–æ–º–∏–∫–µ –∏–ª–∏ —ç–∫–æ–ª–æ–≥–∏–∏?",
            12: "–ö–∞–∫ –≤—ã –±—É–¥–µ—Ç–µ –ø—Ä–æ–¥–≤–∏–≥–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–¥—É–∫—Ç? –ö–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?",
            13: "–ö–∞–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ–º–æ–≥—É—Ç –æ—Ü–µ–Ω–∏—Ç—å —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞? –ö–∞–∫ –≤—ã –±—É–¥–µ—Ç–µ –∏–∑–º–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?",
            14: "–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–º–æ–∂–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç? –ö–∞–∫–∞—è —É –≤–∞—Å –º–æ—Ç–∏–≤–∞—Ü–∏—è –∏ –≤–∏–¥–µ–Ω–∏–µ –±—É–¥—É—â–µ–≥–æ?"
        }
        
        # –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ –ë–î –Ω–∞–ø—Ä—è–º—É—é
        conn = db.get_connection()
        cursor = conn.cursor()
        
        for q_num in questions_without_hints:
            if q_num in hints_data:
                hint_text = hints_data[q_num]
                cursor.execute("""
                    UPDATE interview_questions 
                    SET hint_text = ? 
                    WHERE question_number = ? AND is_active = 1
                """, (hint_text, q_num))
                print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ {q_num}")
        
        conn.commit()
        conn.close()
        
        print("\n‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã!")
    else:
        print("\n‚úÖ –í–°–ï –í–û–ü–†–û–°–´ –£–ñ–ï –ò–ú–ï–Æ–¢ –ü–û–î–°–ö–ê–ó–ö–ò!")
    
    # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    print("\n" + "=" * 50)
    print("–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê:")
    print("-" * 50)
    
    questions = get_interview_questions()
    hints_count = sum(1 for q in questions if q.get('hint_text') and q['hint_text'].strip())
    
    print(f"‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤: {len(questions)}")
    print(f"‚úÖ –í–æ–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏: {hints_count}")
    
    if hints_count == len(questions):
        print("\nüéâ –û–¢–õ–ò–ß–ù–û! –í–°–ï –í–û–ü–†–û–°–´ –ò–ú–ï–Æ–¢ –ü–û–î–°–ö–ê–ó–ö–ò!")
    else:
        print(f"\n‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! {len(questions) - hints_count} –≤–æ–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫!")
    
    print("\n‚ö†Ô∏è –í–ê–ñ–ù–û: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:")
    print("sudo systemctl restart grantservice-bot")

if __name__ == "__main__":
    check_and_fix_hints()