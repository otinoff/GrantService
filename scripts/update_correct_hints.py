#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Скрипт для обновления правильных подсказок с примерами про библиотеку
"""

import sqlite3
import os

def update_correct_hints():
    """Обновляет подсказки на правильные с примерами"""
    
    # Путь к базе данных
    db_path = os.path.join(os.path.dirname(__file__), '..', 'data', 'grantservice.db')
    
    print("=" * 60)
    print("ОБНОВЛЕНИЕ ПОДСКАЗОК НА ПРАВИЛЬНЫЕ")
    print("=" * 60)
    print(f"\nФайл БД: {os.path.abspath(db_path)}")
    
    # Подключаемся к базе
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    # Правильные подсказки с примерами про библиотеку (первые 14 вопросов)
    hints_data = {
        1: "Пример: Мобильная библиотека для людей с ОВЗ",
        
        2: "Пример: создадим выездную библиотеку и аудиокниги, чтобы жители сел Новокузнецкого района с ограничениями в здоровье могли бесплатно получить литературу на дом, образовываться и устраиваться на работу",
        
        3: "Пример: Кемеровская область, новокузнецкий район, пгт...",
        
        4: "Пример: Сельские жители с ОВЗ Новокузнецкого района не имеют доступа к библиотекам, из-за этого страдает культура и развитие, что приводит к пьянству и невозможности устроиться на работу (по отчету минкультуры 2024)",
        
        5: "Пример: Охватим 300 взрослых людей с ОВЗ, проживающих по 3 поселкам Новокузнецкого района",
        
        6: "Пример: Повысить доступность чтения для людей с ОВЗ в сельской местности",
        
        7: "Пример: 1. Оснастить автобус книжным фондом на 1000 экземпляров 2. Провести информационную компанию, чтобы оповестить людей 3.Провести 20 выездных библиотечных сессий с целевой аудиторией",
        
        8: "Пример: 01.06.2028-31.12.28 (6 месяцев)",
        
        9: "Пример: Часть людей может заболеть и не прийти, но мы сделаем запасные даты встреч, чтобы охватить всю целевую аудиторию",
        
        10: "Пример: Руководитель проекта -Марья Ивановна, директор, НКО, 7 лет работает в доме культуры. Библиотекарь, специалист по рекламе, водитель.",
        
        11: "Пример: Администрация Новокузнецкого района, Дом культуры Села ...., Добровольческий фонд \"Надежда\"",
        
        12: "Пример, да, АНО \"Читай-село\", ОГРН ....,дата регистрации 15.06.2021, да, п.2.3 устава \"Культурно-просветительская деятельность\"",
        
        13: "Укажите ссылки на сайт, социальные сети, если есть",
        
        14: "Пример: да, ФПГ, 2023, 450 000, отчет 100% сдан"
    }
    
    print(f"\n[*] Обновляем подсказки для {len(hints_data)} вопросов...")
    
    # Обновляем подсказки для первых 14 вопросов
    updated_count = 0
    for q_num, hint_text in hints_data.items():
        cursor.execute("""
            UPDATE interview_questions 
            SET hint_text = ? 
            WHERE question_number = ? AND is_active = 1
        """, (hint_text, q_num))
        
        if cursor.rowcount > 0:
            print(f"[+] Обновлена подсказка для вопроса {q_num}")
            updated_count += 1
        else:
            print(f"[-] Вопрос {q_num} не найден или не активен")
    
    # Сохраняем изменения
    conn.commit()
    
    print(f"\n[*] Обновлено подсказок: {updated_count}")
    
    # Проверяем результат
    print("\n" + "=" * 60)
    print("ПРОВЕРКА РЕЗУЛЬТАТА:")
    print("-" * 60)
    
    cursor.execute("""
        SELECT 
            question_number, 
            SUBSTR(question_text, 1, 60) as question,
            hint_text
        FROM interview_questions 
        WHERE is_active = 1 AND question_number <= 14
        ORDER BY question_number
    """)
    
    for row in cursor.fetchall():
        q_num = row[0]
        q_text = row[1]
        hint = row[2]
        
        print(f"\nВопрос {q_num}: {q_text}...")
        if hint:
            hint_preview = hint[:80] + "..." if len(hint) > 80 else hint
            print(f"  Подсказка: {hint_preview}")
        else:
            print(f"  [!] НЕТ ПОДСКАЗКИ")
    
    conn.close()
    
    print("\n" + "=" * 60)
    print("[OK] БАЗА ДАННЫХ ОБНОВЛЕНА С ПРАВИЛЬНЫМИ ПОДСКАЗКАМИ!")
    print("=" * 60)
    
    print("\n[!] ТЕПЕРЬ СКОПИРУЙТЕ ФАЙЛ НА СЕРВЕР:")
    print("\n1. Через FileZilla/WinSCP:")
    print("   - Подключитесь к серверу")
    print("   - Перейдите в /var/GrantService/data/")
    print("   - Сделайте резервную копию grantservice.db")
    print("   - Загрузите новый файл grantservice.db")
    print("\n2. Перезапустите бота:")
    print("   ssh user@server 'sudo systemctl restart grantservice-bot'")

if __name__ == "__main__":
    update_correct_hints()