#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Скрипт для обновления подсказок в локальной базе данных
"""

import sqlite3
import os

def update_hints_in_database():
    """Обновляет подсказки прямо в файле базы данных"""
    
    # Путь к базе данных
    db_path = os.path.join(os.path.dirname(__file__), '..', 'data', 'grantservice.db')
    
    print("=" * 60)
    print("ОБНОВЛЕНИЕ ПОДСКАЗОК В БАЗЕ ДАННЫХ")
    print("=" * 60)
    print(f"\nФайл БД: {os.path.abspath(db_path)}")
    
    # Подключаемся к базе
    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    
    # Подсказки с информацией о билетах (как на скриншоте)
    hints_data = {
        1: "ПОДСКАЗКА: Напишите четкое и понятное название проекта. Оно должно отражать суть вашей идеи. Например: 'Платформа для обучения программированию школьников' или 'Мобильное приложение для контроля диабета'. Избегайте общих фраз.",
        
        2: "ПОДСКАЗКА: Опишите конкретную проблему, которую решает ваш проект. Укажите, кто страдает от этой проблемы, как часто она возникает и какие последствия имеет. Используйте статистику и факты.",
        
        3: "ПОДСКАЗКА: Максимально точно опишите вашу целевую аудиторию: возраст, пол, образование, доход, интересы, проблемы. Чем конкретнее портрет, тем лучше. Укажите размер аудитории в цифрах.",
        
        4: "ПОДСКАЗКА: Расскажите о каждом участнике команды: ФИО, роль в проекте, опыт работы, достижения, компетенции. Покажите, почему именно ваша команда способна реализовать проект.",
        
        5: "ПОДСКАЗКА: Детально распишите необходимые ресурсы: финансы (с разбивкой по статьям), время (график проекта), оборудование, помещения, программное обеспечение. Обоснуйте каждую позицию.",
        
        6: "ПОДСКАЗКА: Подробно опишите ваше решение: как оно работает, какие технологии используются, какие функции предоставляет. Объясните, почему именно такой подход эффективен.",
        
        7: "ПОДСКАЗКА: Проведите анализ конкурентов и покажите ваши преимущества: уникальные функции, лучшая цена, удобство использования, инновационный подход. Приведите конкретные примеры.",
        
        8: "ПОДСКАЗКА: Опишите, как проект будет зарабатывать: источники дохода, ценообразование, прогноз выручки на 3 года. Рассмотрите разные сценарии монетизации.",
        
        9: "ПОДСКАЗКА: Составьте детальный план с этапами, сроками и результатами. Укажите ключевые вехи проекта, ответственных за каждый этап. Используйте диаграмму Ганта.",
        
        10: "ПОДСКАЗКА: Проанализируйте все возможные риски: технические, финансовые, рыночные, команды. Для каждого риска укажите вероятность, влияние и план минимизации.",
        
        11: "ПОДСКАЗКА: Опишите социальное, экономическое и экологическое влияние проекта. Приведите конкретные метрики: количество людей, которым поможет проект, экономический эффект в рублях.",
        
        12: "ПОДСКАЗКА: Разработайте маркетинговую стратегию: каналы продвижения, бюджет на маркетинг, контент-план, партнерские программы. Укажите CAC и LTV.",
        
        13: "ПОДСКАЗКА: Определите KPI проекта: количественные и качественные показатели успеха. Опишите систему мониторинга и отчетности. Укажите целевые значения.",
        
        14: "ПОДСКАЗКА: Расскажите о вашей мотивации, видении будущего проекта, почему это важно лично для вас. Покажите страсть и приверженность идее."
    }
    
    print(f"\n[*] Обновляем подсказки для {len(hints_data)} вопросов...")
    
    # Обновляем подсказки для первых 14 вопросов
    for q_num, hint_text in hints_data.items():
        cursor.execute("""
            UPDATE interview_questions
            SET hint_text = ?
            WHERE question_number = ? AND is_active = 1
        """, (hint_text, q_num))
        print(f"[+] Обновлена подсказка для вопроса {q_num}")
    
    # Сохраняем изменения
    conn.commit()
    
    # Проверяем результат
    cursor.execute("""
        SELECT question_number,
               SUBSTR(question_text, 1, 50) as question,
               CASE
                   WHEN hint_text IS NOT NULL AND hint_text != ''
                   THEN '[+] Есть подсказка'
                   ELSE '[-] Нет подсказки'
               END as hint_status
        FROM interview_questions
        WHERE is_active = 1
        ORDER BY question_number
    """)
    
    print("\n" + "=" * 60)
    print("РЕЗУЛЬТАТ:")
    print("-" * 60)
    
    for row in cursor.fetchall():
        print(f"Вопрос {row[0]:2}: {row[2]} | {row[1]}...")
    
    conn.close()
    
    print("\n" + "=" * 60)
    print("[OK] БАЗА ДАННЫХ УСПЕШНО ОБНОВЛЕНА!")
    print("=" * 60)
    print("\n[!] ТЕПЕРЬ СКОПИРУЙТЕ ФАЙЛ НА СЕРВЕР:")
    print("\n1. Сделайте резервную копию на сервере:")
    print("   ssh user@server 'cp /var/GrantService/data/grantservice.db /var/GrantService/data/grantservice.db.backup'")
    print("\n2. Скопируйте обновленный файл:")
    print("   scp GrantService/data/grantservice.db user@server:/var/GrantService/data/")
    print("\n3. Перезапустите бота:")
    print("   ssh user@server 'sudo systemctl restart grantservice-bot'")
    print("\nИЛИ можно использовать FileZilla или любой FTP клиент!")

if __name__ == "__main__":
    update_hints_in_database()