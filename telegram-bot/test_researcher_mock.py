#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è —Å –º–æ–∫-–æ—Ç–≤–µ—Ç–∞–º–∏ Perplexity
"""

import sys
import os
sys.path.append('/var/GrantService')

from data.database import GrantServiceDatabase
import json
import time

class MockPerplexityService:
    """–ú–æ–∫-—Å–µ—Ä–≤–∏—Å –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ Perplexity API"""
    
    def __init__(self):
        self.mock_responses = {
            "–ê–Ω–∞–ª–∏–∑ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤": """
# –ê–Ω–∞–ª–∏–∑ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ –æ–±–ª–∞—Å—Ç–∏ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

## 1. –ü—Ä–æ–µ–∫—Ç "–†–æ—Å—Å–∏–π—Å–∫–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —à–∫–æ–ª–∞" (–†–≠–®)
- **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:** –ú–∏–Ω–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è –†–æ—Å—Å–∏–∏
- **–ì–æ–¥:** 2016-2024
- **–ë—é–¥–∂–µ—Ç:** 1.7 –º–ª—Ä–¥ —Ä—É–±.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** 6.5 –º–ª–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, 350 —Ç—ã—Å. —É—Ä–æ–∫–æ–≤
- **–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:** –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** https://resh.edu.ru

## 2. –ü—Ä–æ–µ–∫—Ç "–£—á–∏.—Ä—É" 
- **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:** –û–û–û "–£—á–∏.—Ä—É"
- **–ì–æ–¥:** 2012-2024
- **–ë—é–¥–∂–µ—Ç:** 500 –º–ª–Ω —Ä—É–±. (—á–∞—Å—Ç–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** 8 –º–ª–Ω —à–∫–æ–ª—å–Ω–∏–∫–æ–≤, 350 —Ç—ã—Å. —É—á–∏—Ç–µ–ª–µ–π
- **–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:** –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** https://uchi.ru

## 3. –ü—Ä–æ–µ–∫—Ç "–Ø–Ω–¥–µ–∫—Å.–£—á–µ–±–Ω–∏–∫"
- **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:** –Ø–Ω–¥–µ–∫—Å
- **–ì–æ–¥:** 2018-2024
- **–ë—é–¥–∂–µ—Ç:** 200 –º–ª–Ω —Ä—É–±.
- **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** 2 –º–ª–Ω —à–∫–æ–ª—å–Ω–∏–∫–æ–≤, 150 —Ç—ã—Å. —É—á–∏—Ç–µ–ª–µ–π
- **–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã —É—Å–ø–µ—Ö–∞:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–∏—Å–∫–æ–≤–∏–∫–æ–º, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** https://education.yandex.ru
""",
            
            "–ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏": """
# –ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏: —à–∫–æ–ª—å–Ω–∏–∫–∏ —Å–µ–ª—å—Å–∫–∏—Ö —Ä–∞–π–æ–Ω–æ–≤

## –î–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- **–í–æ–∑—Ä–∞—Å—Ç:** 11-17 –ª–µ—Ç (5-11 –∫–ª–∞—Å—Å—ã)
- **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –°–µ–ª—å—Å–∫–∏–µ —Ä–∞–π–æ–Ω—ã –ö–µ–º–µ—Ä–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** ~15,000 —à–∫–æ–ª—å–Ω–∏–∫–æ–≤
- **–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å:** –°–µ–º—å–∏ —Å–æ —Å—Ä–µ–¥–Ω–∏–º –∏ –Ω–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ –¥–æ—Ö–æ–¥–æ–º

## –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã
1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—é**
2. **–ù–µ—Ö–≤–∞—Ç–∫–∞ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—á–∏—Ç–µ–ª–µ–π**
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**
4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ï–ì–≠**
5. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –≤–Ω–µ–∫–ª–∞—Å—Å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º**

## –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- –ê–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤ (85%)
- –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –¥–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è (1-2 —á–∞—Å–∞)
- –í—ã—Å–æ–∫–∏–π –∏–Ω—Ç–µ—Ä–µ—Å –∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –Ω–∞–≤—ã–∫–∞–º

## –î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º
- **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç:** 70% –∏–º–µ—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
- **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:** 90% –∏–º–µ—é—Ç —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ã, 40% - –∫–æ–º–ø—å—é—Ç–µ—Ä—ã
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–µ
- **–ö—Ä—É–∂–∫–∏ –∏ —Å–µ–∫—Ü–∏–∏:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

## –ú–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –±–∞—Ä—å–µ—Ä—ã
**–ú–æ—Ç–∏–≤–∞—Ü–∏–∏:**
- –ñ–µ–ª–∞–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- –°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—é –≤ –≤—É–∑
- –ò–Ω—Ç–µ—Ä–µ—Å –∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º

**–ë–∞—Ä—å–µ—Ä—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏–∑-–∑–∞ –Ω–∏–∑–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –≤ —Å–µ–ª—å—Å–∫–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
""",
            
            "–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥—ã": """
# –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥—ã –≤ –æ–±–ª–∞—Å—Ç–∏ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

## –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
- **"–¶–∏—Ñ—Ä–æ–≤–∞—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞"** (–ú–∏–Ω–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è)
  - –ë—é–¥–∂–µ—Ç: 79 –º–ª—Ä–¥ —Ä—É–±. (2020-2024)
  - –ü–æ–∫—Ä—ã—Ç–∏–µ: 100% —à–∫–æ–ª –∫ 2024 –≥–æ–¥—É
  - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞, –º–∞—Å—à—Ç–∞–±
  - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ë—é—Ä–æ–∫—Ä–∞—Ç–∏—è, –º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ

### 2. –ß–∞—Å—Ç–Ω—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- **"–£—á–∏.—Ä—É"** - –ª–∏–¥–µ—Ä —Ä—ã–Ω–∫–∞
  - –ü–æ–∫—Ä—ã—Ç–∏–µ: 8 –º–ª–Ω —à–∫–æ–ª—å–Ω–∏–∫–æ–≤
  - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç, –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è
  - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ü–ª–∞—Ç–Ω–æ—Å—Ç—å, –≥–æ—Ä–æ–¥—Å–∫–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è

- **"–Ø–Ω–¥–µ–∫—Å.–£—á–µ–±–Ω–∏–∫"**
  - –ü–æ–∫—Ä—ã—Ç–∏–µ: 2 –º–ª–Ω —à–∫–æ–ª—å–Ω–∏–∫–æ–≤
  - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ—Å—Ç—å, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–∏—Å–∫–æ–º
  - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 3. –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã
- **"–ú–æ—Å–∫–æ–≤—Å–∫–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —à–∫–æ–ª–∞"**
  - –ü–æ–∫—Ä—ã—Ç–∏–µ: –ú–æ—Å–∫–≤–∞ –∏ –æ–±–ª–∞—Å—Ç—å
  - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –õ–æ–∫–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è
  - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—è

## –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏
1. **–ú–∏–Ω–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è –†–æ—Å—Å–∏–∏** - —Ä–µ–≥—É–ª—è—Ç–æ—Ä –∏ –∫—Ä—É–ø–Ω–µ–π—à–∏–π –∏–≥—Ä–æ–∫
2. **–†–æ—Å—Å–∏–π—Å–∫–∞—è –∞–∫–∞–¥–µ–º–∏—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è** - –Ω–∞—É—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
3. **–§–æ–Ω–¥ "–í–∫–ª–∞–¥ –≤ –±—É–¥—É—â–µ–µ"** - —á–∞—Å—Ç–Ω—ã–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
4. **–°–±–µ—Ä–±–∞–Ω–∫** - –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

## –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å –ú–∏–Ω–ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≥–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏** (–£—á–∏.—Ä—É, –Ø–Ω–¥–µ–∫—Å)
- **–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ —Å –º–µ—Å—Ç–Ω—ã–º–∏ —à–∫–æ–ª–∞–º–∏** –¥–ª—è –ø–∏–ª–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å –≤—É–∑–∞–º–∏** –¥–ª—è –º–µ—Ç–æ–¥–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏

## –ù–∏—à–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
**–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–µ–ª—å—Å–∫–∏—Ö —Ä–∞–π–æ–Ω–∞—Ö
- –ë–µ—Å–ø–ª–∞—Ç–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –õ–æ–∫–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä–µ–≥–∏–æ–Ω
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏
"""
        }
    
    def search_grants(self, query: str) -> str:
        """–ò–º–∏—Ç–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –≥—Ä–∞–Ω—Ç–æ–≤"""
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        if "–ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤" in query:
            return self.mock_responses["–ê–Ω–∞–ª–∏–∑ –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤"]
        elif "—Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏" in query:
            return self.mock_responses["–ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏"]
        elif "–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥—ã" in query:
            return self.mock_responses["–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥—ã"]
        else:
            return "–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä–∞–Ω—Ç–∞—Ö –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö —Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ —Å–µ–ª—å—Å–∫–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏."

def test_researcher_with_mock():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≥–µ–Ω—Ç–∞-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è —Å –º–æ–∫-–æ—Ç–≤–µ—Ç–∞–º–∏"""
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ë–î –∏ –º–æ–∫-—Å–µ—Ä–≤–∏—Å
    db = GrantServiceDatabase()
    mock_service = MockPerplexityService()
    
    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞-–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è —Å –º–æ–∫-–æ—Ç–≤–µ—Ç–∞–º–∏")
    print("=" * 60)
    
    # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–º–ø—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    researcher_prompts = db.get_agent_prompts('researcher')
    
    if not researcher_prompts:
        print("‚ùå –ü—Ä–æ–º–ø—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –ë–î")
        return
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(researcher_prompts)} –ø—Ä–æ–º–ø—Ç–æ–≤ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è")
    print()
    
    # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–º–∏—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤—å—é)
    test_user_data = {
        'project_name': '–¶–∏—Ñ—Ä–æ–≤–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–µ–ª—å—Å–∫–∏—Ö —à–∫–æ–ª',
        'project_description': '–°–æ–∑–¥–∞–Ω–∏–µ –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –≤ —Å–µ–ª—å—Å–∫–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π',
        'target_audience': '–®–∫–æ–ª—å–Ω–∏–∫–∏ 5-11 –∫–ª–∞—Å—Å–æ–≤ –≤ —Å–µ–ª—å—Å–∫–∏—Ö —Ä–∞–π–æ–Ω–∞—Ö',
        'region': '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å',
        'budget': '5000000',
        'duration': '24 –º–µ—Å—è—Ü–∞'
    }
    
    print("üìã –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞:")
    for key, value in test_user_data.items():
        print(f"  {key}: {value}")
    print()
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ task –ø—Ä–æ–º–ø—Ç—ã
    task_prompts = [p for p in researcher_prompts if p['prompt_type'] == 'task']
    
    print(f"üéØ –ù–∞–π–¥–µ–Ω–æ {len(task_prompts)} task –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:")
    for i, prompt in enumerate(task_prompts, 1):
        print(f"  {i}. {prompt['prompt_name']}")
    print()
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞–∂–¥—ã–π task –ø—Ä–æ–º–ø—Ç
    for i, prompt in enumerate(task_prompts, 1):
        print(f"üöÄ –í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–æ–º–ø—Ç {i}: {prompt['prompt_name']}")
        print("-" * 40)
        
        # –°—Ç—Ä–æ–∏–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–º–ø—Ç–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        query = f"""
{prompt['prompt_content']}

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞:
- –ù–∞–∑–≤–∞–Ω–∏–µ: {test_user_data['project_name']}
- –û–ø–∏—Å–∞–Ω–∏–µ: {test_user_data['project_description']}
- –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {test_user_data['target_audience']}
- –†–µ–≥–∏–æ–Ω: {test_user_data['region']}
- –ë—é–¥–∂–µ—Ç: {test_user_data['budget']} —Ä—É–±.
- –°—Ä–æ–∫: {test_user_data['duration']}

–ü—Ä–æ–≤–µ–¥–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞–Ω–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É.
"""
        
        print(f"üìù –ó–∞–ø—Ä–æ—Å –∫ Perplexity:")
        print(query[:200] + "..." if len(query) > 200 else query)
        print()
        
        try:
            # –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É API
            time.sleep(1)
            
            # –ü–æ–ª—É—á–∞–µ–º –º–æ–∫-–æ—Ç–≤–µ—Ç
            response = mock_service.search_grants(query)
            
            print(f"‚úÖ –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω ({len(response)} —Å–∏–º–≤–æ–ª–æ–≤)")
            print("üìÑ –û—Ç–≤–µ—Ç:")
            print(response[:500] + "..." if len(response) > 500 else response)
            print()
            
            # –õ–æ–≥–∏—Ä—É–µ–º –≤ –ë–î
            log_data = {
                'user_id': 999,  # —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                'session_id': 999,  # —Ç–µ—Å—Ç–æ–≤–∞—è —Å–µ—Å—Å–∏—è
                'query_text': query,
                'perplexity_response': response,
                'sources': 'Mock Perplexity API',
                'usage_stats': 'test_query_mock',
                'cost': 0.0,  # –º–æ–∫-–∑–∞–ø—Ä–æ—Å—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã
                'status': 'success',
                'error_message': None
            }
            
            db.log_researcher_query(**log_data)
            print(f"üíæ –ó–∞–ø—Ä–æ—Å –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω –≤ –ë–î")
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞: {e}")
            
            # –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
            log_data = {
                'user_id': 999,
                'session_id': 999,
                'query_text': query,
                'perplexity_response': None,
                'sources': None,
                'usage_stats': 'error',
                'cost': 0,
                'status': 'error',
                'error_message': str(e)
            }
            
            db.log_researcher_query(**log_data)
        
        print("=" * 60)
        print()
    
    print("üéâ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
    print("üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è'")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    try:
        stats = db.get_researcher_statistics()
        print("\nüìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—è:")
        print(f"  –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: {stats.get('total_queries', 0)}")
        print(f"  –£—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: {stats.get('successful_queries', 0)}")
        print(f"  –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: {stats.get('success_rate', 0):.1f}%")
        print(f"  –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: {stats.get('total_cost', 0):.2f}$")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {e}")

if __name__ == "__main__":
    test_researcher_with_mock() 